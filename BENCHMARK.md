# 4K Benchmark Guide - RTX 4070 Target

## Описание

Тестовая сцена в разрешении 4K (3840x2160) для проверки производительности на уровне RTX 4070.

## Характеристики RTX 4070

- **Производительность**: ~29 TFLOPs (FP32)
- **VRAM**: 12GB GDDR6X
- **4K Performance**: Оптимизирована для 60 FPS в большинстве игр

## Конфигурации бенчмарка

### Standard (RTX 4070 Target)
- **Разрешение**: 4K (3840x2160)
- **Частицы**: 2,000,000
- **Агенты**: 5,000
- **Паттерн сцены**: Dense
- **Длительность**: 30 секунд
- **Целевой FPS**: 60

### Light
- **Разрешение**: 4K (3840x2160)
- **Частицы**: 1,000,000
- **Агенты**: 2,000
- **Паттерн сцены**: Medium
- **Длительность**: 10 секунд
- **Целевой FPS**: 60

### Heavy (Stress Test)
- **Разрешение**: 4K (3840x2160)
- **Частицы**: 4,000,000
- **Агенты**: 10,000
- **Паттерн сцены**: Dense
- **Длительность**: 60 секунд
- **Целевой FPS**: 60

## Запуск бенчмарка

### Через основной движок

```bash
cargo run --bin adaptive-entity-engine
```

В окне нажмите:
- **B** - Стандартный бенчмарк (RTX 4070 target)
- **L** - Легкий бенчмарк
- **H** - Тяжелый бенчмарк (stress test)

### Через отдельный бинарник

```bash
# Стандартный бенчмарк
cargo run --release --bin benchmark

# Легкий бенчмарк
cargo run --release --bin benchmark light

# Тяжелый бенчмарк
cargo run --release --bin benchmark heavy
```

## Метрики производительности

Бенчмарк собирает следующие метрики:

- **Average FPS** - Средний FPS за весь тест
- **Min FPS** - Минимальный FPS
- **Max FPS** - Максимальный FPS
- **Average Frame Time** - Среднее время кадра в миллисекундах
- **1% Low FPS** - FPS в худшем 1% кадров (показывает стабильность)
- **0.1% Low FPS** - FPS в худшем 0.1% кадров (показывает просадки)
- **GPU Utilization** - Средняя загрузка GPU
- **VRAM Usage** - Использование видеопамяти

## Ожидаемые результаты для RTX 4070

### Standard Benchmark
- **Average FPS**: 55-65 FPS
- **1% Low FPS**: 45-55 FPS
- **0.1% Low FPS**: 40-50 FPS
- **GPU Utilization**: 85-95%
- **VRAM Usage**: ~2-4 GB

### Light Benchmark
- **Average FPS**: 70-90 FPS
- **1% Low FPS**: 60-75 FPS
- **GPU Utilization**: 70-85%

### Heavy Benchmark
- **Average FPS**: 35-50 FPS
- **1% Low FPS**: 25-40 FPS
- **GPU Utilization**: 95-100%
- **VRAM Usage**: ~4-6 GB

## Компоненты тестовой сцены

### Объекты сцены
- **Платформы**: ~280 объектов в сетке 41x41
- **Лестницы**: 10 объектов
- **Рампы**: 8 объектов
- **Игрушки**: 50 объектов, разбросанных по кругу

### Агенты
- Размещены в сетке
- Различные FSM поведения (Wander, Follow, Interact, Idle)
- Spatial hash для коллизий
- LOD система на основе расстояния

### Частицы
- GPU compute обновления
- Физика (гравитация, демпфирование)
- Коллизии с границами
- Разноцветные частицы

## Интерпретация результатов

### Хорошая производительность
- Average FPS ≥ 55 (Standard)
- 1% Low FPS ≥ 45
- Стабильная загрузка GPU (85-95%)

### Средняя производительность
- Average FPS 40-55 (Standard)
- 1% Low FPS 30-45
- Нестабильная загрузка GPU

### Низкая производительность
- Average FPS < 40 (Standard)
- 1% Low FPS < 30
- GPU не справляется с нагрузкой

## Оптимизация

Если производительность ниже ожидаемой:

1. **Уменьшите количество частиц** - измените `particle_count` в `BenchmarkConfig`
2. **Уменьшите количество агентов** - измените `agent_count`
3. **Используйте Medium паттерн** вместо Dense
4. **Проверьте драйверы GPU** - обновите до последней версии
5. **Проверьте настройки системы** - убедитесь, что нет фоновых процессов

## Технические детали

- **Рендеринг**: wgpu (Vulkan/OpenGL)
- **Compute**: GPU compute shaders для частиц
- **ECS**: bevy_ecs для управления сущностями
- **Математика**: glam для векторов и матриц

## Примечания

- Бенчмарк автоматически завершается после указанной длительности
- Результаты выводятся в консоль
- Во время бенчмарка нельзя переключать паттерны сцены
- Для точных результатов запускайте в release режиме: `cargo run --release`
