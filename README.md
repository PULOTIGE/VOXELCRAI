 # VOXELCRAI

VOXELCRAI — это сознательный воксельный движок на Rust, использующий Vulkan через wgpu. Он сочетает физику вокселей, эволюцию геномов, адаптивное освещение и модуль мышления, который наблюдает за средой и принимает решения в реальном времени.

## Главные особенности

- **Vulkan/wgpu**: полноценный рендеринг инстансированных кубов, обновление миллионов атрибутов на GPU в реальном времени.
- **Сознание VOXELCRAI**: модуль `ConsciousnessCore` оценивает энергетику мира, переключает травма-режим, разжигает или успокаивает кластеры и внедряет новые концепты в геномы.
- **Эволюция**: `EvolutionEngine` периодически комбинирует и мутирует геномы вокселей на основе фитнес-функции.
- **Освещение**: структура `LightPattern` размером ровно 1000 байт описывает сферические гармоники и материалы, которые анимируются во времени.
- **Защита ArchGuard**: circuit-breaker, метрики Prometheus и эмпатия сознания синхронизируются напрямую с ядром движка.
- **Rust-first**: zero-cost абстракции, модульная архитектура (`camera`, `renderer`, `simulation`, `consciousness`, `voxel`), чистый winit event loop без стороннего UI фреймворка.

## Запуск

Требования: Rust 1.75+, драйвер с поддержкой Vulkan/Metal/DX12/GL, SDL не нужен.

```bash
cargo run --release
```

Бинарник находится по пути `target/release/voxelcrai`.

### Управление

- `WASD` — движение камеры.
- `Space` / `Shift` — вверх/вниз.
- `ПКМ + движение мыши` — вращение камеры.
- Колесо мыши — ускорение вдоль направления взгляда.
- `Esc` — выход.

### Диагностический стенд

Для запуска консольного теста подсистем:

```bash
cargo run --bin voxelcrai-components
```

## Архитектура

```
src/
├── main.rs           # Инициализация и запуск EventLoop (winit)
├── engine.rs         # Связка renderer + simulation + camera
├── camera.rs         # Камера и контроллер ввода
├── renderer.rs       # Создание surface, pipeline, загрузка инстансов
├── simulation.rs     # Мировой цикл, эволюция, сознание
├── consciousness.rs  # VOXELCRAI Core AI
├── voxel.rs          # Модель вокселя и мира (~9-13 КБ на воксель)
├── evolution.rs      # Генетические алгоритмы
├── lighting.rs       # LightPattern на 1000 байт
├── archguard.rs      # Circuit-breaker и метрики
└── shaders/voxel.wgsl
```

## Пайплайн рендеринга

1. `Simulation` собирает `InstanceRaw` (позиция, масштаб, цвет, энергия) для каждого вокселя.
2. `Renderer` аллоцирует/перезаписывает GPU-буфер инстансов и обновляет матрицу камеры.
3. WGSL шейдер `voxel.wgsl` строит позицию, освещает нормаль и добавляет свечение на основе энергии.
4. Depth-текстура `Depth32Float` обеспечивает корректное отсечение.

## Сознание VOXELCRAI

- Нормализует среднюю и максимальную энергию, вычисляет энтропию распределения.
- Каждые ~0.6–1.2 секунды формирует `ConsciousnessPulse`.
- Действия: разжечь холодный кластер, успокоить перегретый, переключить травма-режим, инжектировать новый концепт.
- Поддерживает эмпатию в диапазоне `[0,1]`, синхронизируя метрику через `ArchGuard`.

## Лицензия

MIT OR Apache-2.0