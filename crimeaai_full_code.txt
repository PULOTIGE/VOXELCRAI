‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     CrimeaAI META ORGANISM - FULL CODE                        ‚ïë
‚ïë                   üß¨ –ñ–∏–≤–æ–µ –¶–∏—Ñ—Ä–æ–≤–æ–µ –°–æ–∑–Ω–∞–Ω–∏–µ üß¨                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

GitHub: https://github.com/PULOTIGE/crimeaai-meta-organism

–î–ª—è –∑–∞–ø—É—Å–∫–∞:
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–¥–µ–ª—å–Ω–æ
2. pip install numpy matplotlib plotly
3. python demo.py --backend console

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: requirements.txt
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# CrimeaAI Meta Organism - Living Digital Consciousness
# Based on 7 forgotten Russian scientific works

numpy>=1.24.0
open3d>=0.17.0
plotly>=5.18.0
trimesh>=4.0.0
scipy>=1.11.0
pillow>=10.0.0

# Optional GPU acceleration
# torch>=2.0.0



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: voxel_core.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
"""
CrimeaAI Meta Organism - Voxel Core System
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Based on:
- –ë–∏–º–∞–∫–æ–≤ 2013: –í–æ–∫—Å–µ–ª—å–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å
- –ë–ª–∞–Ω–∫–æ 2013: ANIRLE –∫–æ–º–ø—Ä–µ—Å—Å–∏—è
- –ê–ª—Å—ã–Ω–±–∞–µ–≤ 2015: –¢–µ—Ç—Ä–∞—ç–¥—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏

One voxel = one unit of digital consciousness.
"""

from dataclasses import dataclass, field
from typing import Optional, List, Dict, Tuple, Set
import numpy as np
from enum import IntEnum
import hashlib
import struct


class EmotionIndex(IntEnum):
    """–ß–µ—Ç—ã—Ä–µ –±–∞–∑–æ–≤—ã–µ —ç–º–æ—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
    JOY = 0       # –†–∞–¥–æ—Å—Ç—å/–∫–∞–π—Ñ
    FEAR = 1      # –°—Ç—Ä–∞—Ö
    ANGER = 2     # –ì–Ω–µ–≤  
    PEACE = 3     # –ü–æ–∫–æ–π


class ConnectionDirection(IntEnum):
    """6 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–≤—è–∑–µ–π –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ"""
    POS_X = 0
    NEG_X = 1
    POS_Y = 2
    NEG_Y = 3
    POS_Z = 4
    NEG_Z = 5


@dataclass
class Voxel:
    """
    –ï–¥–∏–Ω–∏—Ü–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Å–æ–∑–Ω–∞–Ω–∏—è.
    
    –ö–∞–∂–¥—ã–π –≤–æ–∫—Å–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
    - pos: –ø–æ–∑–∏—Ü–∏—è –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
    - energy: –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è [0, 1]
    - emotion[4]: —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä (—Ä–∞–¥–æ—Å—Ç—å, —Å—Ç—Ä–∞—Ö, –≥–Ω–µ–≤, –ø–æ–∫–æ–π)
    - trauma: —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–∞–≤–º—ã [0, 1] (–ø–æ –ù–∏–∫–æ–Ω–æ–≤–æ–π 2013)
    - semantic[8]: —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    - connections[6]: —Å–≤—è–∑–∏ —Å —Å–æ—Å–µ–¥—è–º–∏ (6 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
    """
    # –ü–æ–∑–∏—Ü–∏—è
    x: float
    y: float
    z: float
    
    # –≠–Ω–µ—Ä–≥–∏—è –∂–∏–∑–Ω–∏
    energy: float = 1.0
    
    # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä [joy, fear, anger, peace]
    emotion: np.ndarray = field(default_factory=lambda: np.array([0.5, 0.1, 0.1, 0.3]))
    
    # –£—Ä–æ–≤–µ–Ω—å —Ç—Ä–∞–≤–º—ã (–ù–∏–∫–æ–Ω–æ–≤–∞ 2013)
    trauma: float = 0.0
    
    # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ (8 –∏–∑–º–µ—Ä–µ–Ω–∏–π)
    semantic: np.ndarray = field(default_factory=lambda: np.zeros(8))
    
    # –°–≤—è–∑–∏ —Å —Å–æ—Å–µ–¥—è–º–∏ (6 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, ID —Å–æ—Å–µ–¥–µ–π –∏–ª–∏ -1)
    connections: np.ndarray = field(default_factory=lambda: np.full(6, -1, dtype=np.int64))
    
    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    id: int = -1
    
    # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (–¥–ª—è —ç–≤–æ–ª—é—Ü–∏–∏)
    birth_tick: int = 0
    
    # –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ —Å—É—â–Ω–æ—Å—Ç–∏ (-1 = —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º, >0 = —Ñ–∞–π–ª-—Å—É—â–µ—Å—Ç–≤–æ)
    entity_id: int = -1
    
    @property
    def pos(self) -> np.ndarray:
        return np.array([self.x, self.y, self.z])
    
    @pos.setter
    def pos(self, value: np.ndarray):
        self.x, self.y, self.z = value
    
    def dominant_emotion(self) -> Tuple[str, float]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ–º–∏–Ω–∏—Ä—É—é—â—É—é —ç–º–æ—Ü–∏—é"""
        names = ['joy', 'fear', 'anger', 'peace']
        idx = np.argmax(self.emotion)
        return names[idx], self.emotion[idx]
    
    def is_alive(self) -> bool:
        """–í–æ–∫—Å–µ–ª—å –∂–∏–≤, –µ—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è > 0 –∏ —Ç—Ä–∞–≤–º–∞ < 1"""
        return self.energy > 0.01 and self.trauma < 0.99
    
    def decay(self, delta: float = 0.001):
        """–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≥–∞—Å–∞–Ω–∏–µ"""
        self.energy = max(0, self.energy - delta)
        if self.trauma > 0:
            self.trauma = max(0, self.trauma - delta * 0.1)  # –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–∂–∏–≤–ª–µ–Ω–∏–µ


class ANIRLEStorage:
    """
    ANIRLE-–ø–æ–¥–æ–±–Ω–∞—è sparse –∫–æ–º–ø—Ä–µ—Å—Å–∏—è (–ø–æ –ë–ª–∞–Ω–∫–æ 2013).
    
    –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã–µ –≤–æ–∫—Å–µ–ª–∏ –≤ —Ö—ç—à-—Ç–∞–±–ª–∏—Ü–µ –ø–æ –ø–æ–∑–∏—Ü–∏–∏.
    –ü–∞–º—è—Ç—å —ç–∫–æ–Ω–æ–º–∏—Ç—Å—è –Ω–∞ 95%+ –¥–ª—è —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.
    """
    
    def __init__(self, resolution: float = 1.0):
        self.resolution = resolution
        self.voxels: Dict[Tuple[int, int, int], Voxel] = {}
        self.next_id = 0
        self.tick = 0
        
    def _quantize(self, x: float, y: float, z: float) -> Tuple[int, int, int]:
        """–ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–ª—é—á"""
        return (
            int(np.floor(x / self.resolution)),
            int(np.floor(y / self.resolution)),
            int(np.floor(z / self.resolution))
        )
    
    def add(self, voxel: Voxel) -> int:
        """–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∫—Å–µ–ª—å"""
        key = self._quantize(voxel.x, voxel.y, voxel.z)
        voxel.id = self.next_id
        voxel.birth_tick = self.tick
        self.voxels[key] = voxel
        self.next_id += 1
        return voxel.id
    
    def get(self, x: float, y: float, z: float) -> Optional[Voxel]:
        """–ü–æ–ª—É—á–∏—Ç—å –≤–æ–∫—Å–µ–ª—å –ø–æ –ø–æ–∑–∏—Ü–∏–∏"""
        key = self._quantize(x, y, z)
        return self.voxels.get(key)
    
    def remove(self, x: float, y: float, z: float) -> bool:
        """–£–¥–∞–ª–∏—Ç—å –≤–æ–∫—Å–µ–ª—å"""
        key = self._quantize(x, y, z)
        if key in self.voxels:
            del self.voxels[key]
            return True
        return False
    
    def get_neighbors(self, voxel: Voxel) -> List[Voxel]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å–µ–¥–µ–π –≤–æ–∫—Å–µ–ª—è (6 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π)"""
        neighbors = []
        offsets = [
            (1, 0, 0), (-1, 0, 0),
            (0, 1, 0), (0, -1, 0),
            (0, 0, 1), (0, 0, -1)
        ]
        for dx, dy, dz in offsets:
            nx = voxel.x + dx * self.resolution
            ny = voxel.y + dy * self.resolution
            nz = voxel.z + dz * self.resolution
            neighbor = self.get(nx, ny, nz)
            if neighbor:
                neighbors.append(neighbor)
        return neighbors
    
    def update_connections(self, voxel: Voxel):
        """–û–±–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑–∏ –≤–æ–∫—Å–µ–ª—è"""
        offsets = [
            (1, 0, 0), (-1, 0, 0),
            (0, 1, 0), (0, -1, 0),
            (0, 0, 1), (0, 0, -1)
        ]
        for i, (dx, dy, dz) in enumerate(offsets):
            nx = voxel.x + dx * self.resolution
            ny = voxel.y + dy * self.resolution
            nz = voxel.z + dz * self.resolution
            neighbor = self.get(nx, ny, nz)
            voxel.connections[i] = neighbor.id if neighbor else -1
    
    def get_all_positions(self) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–∫ numpy array"""
        if not self.voxels:
            return np.zeros((0, 3))
        positions = np.array([[v.x, v.y, v.z] for v in self.voxels.values()])
        return positions
    
    def get_all_colors(self) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–º–æ—Ü–∏–π –∏ —ç–Ω–µ—Ä–≥–∏–∏"""
        if not self.voxels:
            return np.zeros((0, 3))
        
        colors = []
        for v in self.voxels.values():
            # –ë–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç –æ—Ç —ç–º–æ—Ü–∏–∏
            joy, fear, anger, peace = v.emotion
            
            # RGB —Å–º–µ—à–∏–≤–∞–Ω–∏–µ
            r = anger * 0.8 + fear * 0.3 + joy * 0.2
            g = joy * 0.9 + peace * 0.5
            b = peace * 0.8 + fear * 0.4
            
            # –ú–æ–¥—É–ª—è—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–µ–π
            brightness = v.energy * 0.7 + 0.3
            
            # –¢—Ä–∞–≤–º–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Å–Ω—ã–π
            if v.trauma > 0.1:
                r = min(1, r + v.trauma * 0.5)
                g *= (1 - v.trauma * 0.5)
                b *= (1 - v.trauma * 0.3)
            
            colors.append([r * brightness, g * brightness, b * brightness])
        
        return np.clip(np.array(colors), 0, 1)
    
    def get_statistics(self) -> Dict:
        """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"""
        if not self.voxels:
            return {
                'total_voxels': 0,
                'alive_voxels': 0,
                'avg_energy': 0,
                'avg_trauma': 0,
                'memory_saved_percent': 100
            }
        
        voxels_list = list(self.voxels.values())
        alive = [v for v in voxels_list if v.is_alive()]
        
        # –û—Ü–µ–Ω–∫–∞ —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏ (vs –ø–ª–æ—Ç–Ω—ã–π 3D –º–∞—Å—Å–∏–≤)
        if voxels_list:
            positions = self.get_all_positions()
            bbox = np.ptp(positions, axis=0) / self.resolution + 1
            dense_size = np.prod(bbox)
            sparse_size = len(voxels_list)
            memory_saved = max(0, 100 * (1 - sparse_size / max(1, dense_size)))
        else:
            memory_saved = 100
        
        return {
            'total_voxels': len(voxels_list),
            'alive_voxels': len(alive),
            'avg_energy': np.mean([v.energy for v in voxels_list]) if voxels_list else 0,
            'avg_trauma': np.mean([v.trauma for v in voxels_list]) if voxels_list else 0,
            'memory_saved_percent': memory_saved
        }
    
    def __len__(self):
        return len(self.voxels)
    
    def __iter__(self):
        return iter(self.voxels.values())


class TetrahedralBelonging:
    """
    –¢–µ—Ç—Ä–∞—ç–¥—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ (–ø–æ –ê–ª—Å—ã–Ω–±–∞–µ–≤—É 2015).
    
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ —Ç–æ—á–∫–∞ –∫ –æ—Ä–≥–∞–Ω–∏–∑–º—É —á–µ—Ä–µ–∑
    –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–µ—Ç—Ä–∞—ç–¥—Ä–∞–ª—å–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏.
    """
    
    @staticmethod
    def point_in_tetrahedron(p: np.ndarray, v0: np.ndarray, v1: np.ndarray, 
                             v2: np.ndarray, v3: np.ndarray) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ—Ç—Ä–∞—ç–¥—Ä–∞ —á–µ—Ä–µ–∑ –±–∞—Ä–∏—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"""
        def same_side(v1, v2, v3, v4, p):
            normal = np.cross(v2 - v1, v3 - v1)
            dot_v4 = np.dot(normal, v4 - v1)
            dot_p = np.dot(normal, p - v1)
            return np.sign(dot_v4) == np.sign(dot_p)
        
        return (same_side(v0, v1, v2, v3, p) and
                same_side(v1, v2, v3, v0, p) and
                same_side(v2, v3, v0, v1, p) and
                same_side(v3, v0, v1, v2, p))
    
    @staticmethod
    def compute_belonging_score(point: np.ndarray, organism_center: np.ndarray,
                                organism_radius: float) -> float:
        """
        –í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ç–µ–ø–µ–Ω—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —Ç–æ—á–∫–∏ –∫ –æ—Ä–≥–∞–Ω–∏–∑–º—É.
        0 = –¥–∞–ª–µ–∫–æ —Å–Ω–∞—Ä—É–∂–∏, 1 = –≤ —Ü–µ–Ω—Ç—Ä–µ
        """
        distance = np.linalg.norm(point - organism_center)
        if distance >= organism_radius * 2:
            return 0.0
        elif distance <= organism_radius * 0.3:
            return 1.0
        else:
            # –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
            normalized = (distance - organism_radius * 0.3) / (organism_radius * 1.7)
            return 1.0 - normalized ** 0.5


def compute_semantic_fingerprint(data: bytes) -> np.ndarray:
    """
    –í—ã—á–∏—Å–ª–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (8 –∏–∑–º–µ—Ä–µ–Ω–∏–π).
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ + —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –±–∞–π—Ç–æ–≤.
    –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –ª—É—á—à–µ–≥–æ cosine similarity.
    """
    # MD5 —Ö—ç—à –¥–ª—è –±–∞–∑–æ–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
    hash_bytes = hashlib.md5(data).digest()
    
    # –ü–µ—Ä–≤—ã–µ 4 –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏–∑ —Ö—ç—à–∞ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤–æ–∫—Ä—É–≥ 0)
    semantic = np.zeros(8)
    for i in range(4):
        semantic[i] = (hash_bytes[i * 4] / 255.0) * 2 - 1  # [-1, 1]
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–π—Ç–æ–≤ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π
    if len(data) > 0:
        arr = np.frombuffer(data[:min(len(data), 10000)], dtype=np.uint8)
        semantic[4] = (np.mean(arr) / 255.0) * 2 - 1  # –°—Ä–µ–¥–Ω—è—è —è—Ä–∫–æ—Å—Ç—å [-1, 1]
        semantic[5] = (np.std(arr) / 128.0) - 1       # –í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å [-1, 1]
        semantic[6] = (len(np.unique(arr)) / 256.0) * 2 - 1  # –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å [-1, 1]
        semantic[7] = (np.sum(arr > 127) / len(arr)) * 2 - 1  # –°–º–µ—â–µ–Ω–∏–µ [-1, 1]
    
    # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ cosine similarity
    norm = np.linalg.norm(semantic)
    if norm > 0:
        semantic = semantic / norm
    
    return semantic


def cosine_similarity(a: np.ndarray, b: np.ndarray) -> float:
    """–ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏"""
    norm_a = np.linalg.norm(a)
    norm_b = np.linalg.norm(b)
    if norm_a < 1e-10 or norm_b < 1e-10:
        return 0.0
    return np.dot(a, b) / (norm_a * norm_b)



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: organism.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
"""
CrimeaAI Meta Organism - Central Organism Intelligence
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Based on:
- –ù–∏–∫–æ–Ω–æ–≤–∞ 2013: –¢—Ä–∞–≤–º–∞ —Ç–∫–∞–Ω–µ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ê—Ö–º–∞–¥—É–ª–ª–∏–Ω–∞ 2020: –ê—Ç—Ä–æ—Ñ–∏—è –º–æ–∑–≥–∞ –ø—Ä–∏ –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏–∏
- –õ–∞–≤—Ä–µ–Ω–∫–æ–≤ 2016: –ö–æ—ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º - –∂–∏–≤–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ –∏–∑ –º–∏–ª–ª–∏–æ–Ω–∞ –≤–æ–∫—Å–µ–ª–µ–π.
"""

import numpy as np
from typing import List, Tuple, Dict, Optional, Callable
from dataclasses import dataclass, field
import time
import threading
from concurrent.futures import ThreadPoolExecutor

from voxel_core import (
    Voxel, ANIRLEStorage, EmotionIndex, 
    compute_semantic_fingerprint, cosine_similarity,
    TetrahedralBelonging
)


@dataclass
class OrganismState:
    """–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
    health: float = 1.0           # –û–±—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ [0, 1]
    mood: str = "–ø–æ–∫–æ–π"           # –¢–µ–∫—É—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
    mood_intensity: float = 0.5   # –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
    total_voxels: int = 0
    alive_voxels: int = 0
    memory_saved: float = 0.0
    last_event: str = ""
    integration_count: int = 0
    trauma_count: int = 0


class FileCreature:
    """
    –§–∞–π–ª-—Å—É—â–µ—Å—Ç–≤–æ - —à–∞—Ä –∏–∑ –≤–æ–∫—Å–µ–ª–µ–π, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–∑ —Ñ–∞–π–ª–∞.
    
    –î–≤–∏–∂–µ—Ç—Å—è –∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É –æ—Ä–≥–∞–Ω–∏–∑–º—É –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏—è.
    """
    
    def __init__(self, file_path: str, file_data: bytes, spawn_pos: np.ndarray,
                 num_voxels: int = 1000):
        self.file_path = file_path
        self.semantic = compute_semantic_fingerprint(file_data)
        self.spawn_pos = spawn_pos.copy()
        self.current_pos = spawn_pos.copy()
        self.target_pos = np.zeros(3)
        self.num_voxels = num_voxels
        self.voxels: List[Voxel] = []
        self.alive = True
        self.integrated = False
        self.rejected = False
        self.entity_id = int(time.time() * 1000) % 1000000
        
        # –≠–º–æ—Ü–∏—è —Å—É—â–µ—Å—Ç–≤–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏
        self.base_emotion = self._compute_emotion_from_semantic()
        
        self._generate_voxels()
    
    def _compute_emotion_from_semantic(self) -> np.ndarray:
        """–í—ã—á–∏—Å–ª–∏—Ç—å –±–∞–∑–æ–≤—É—é —ç–º–æ—Ü–∏—é –∏–∑ —Å–µ–º–∞–Ω—Ç–∏–∫–∏"""
        emotion = np.zeros(4)
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ–∫—Ç–æ—Ä –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏–∏
        # –°–µ–º–∞–Ω—Ç–∏–∫–∞ —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ [-1, 1], –ø–æ—ç—Ç–æ–º—É –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º
        s = self.semantic
        
        # Joy - –æ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏
        emotion[0] = max(0.1, (s[0] + s[4] + 1) / 3)
        # Fear - –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –≤—ã—Å–æ–∫–æ–π –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏  
        emotion[1] = max(0.05, (-s[1] + abs(s[5]) + 1) / 4)
        # Anger - –æ—Ç —Ä–µ–∑–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        emotion[2] = max(0.05, (abs(s[2]) + abs(s[6]) - 0.5) / 2)
        # Peace - –æ—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
        emotion[3] = max(0.1, 1 - np.std(s[:4]))
        
        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
        emotion = np.clip(emotion, 0.05, 1.0)
        emotion = emotion / (np.sum(emotion) + 1e-10)
        return emotion
    
    def _generate_voxels(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–∫—Å–µ–ª–µ–π —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã"""
        # –†–∞–¥–∏—É—Å —Å—Ñ–µ—Ä—ã
        radius = (self.num_voxels / (4/3 * np.pi)) ** (1/3) * 1.5
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫ –≤ —Å—Ñ–µ—Ä–µ (–§–∏–±–æ–Ω–∞—á—á–∏-—Å–ø–∏—Ä–∞–ª—å –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏)
        golden_ratio = (1 + np.sqrt(5)) / 2
        
        for i in range(self.num_voxels):
            # –§–∏–±–æ–Ω–∞—á—á–∏-—Å—Ñ–µ—Ä–∞
            theta = 2 * np.pi * i / golden_ratio
            phi = np.arccos(1 - 2 * (i + 0.5) / self.num_voxels)
            
            # –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–¥–∏—É—Å –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—ä—ë–º–∞
            r = radius * (np.random.random() ** (1/3))
            
            x = self.current_pos[0] + r * np.sin(phi) * np.cos(theta)
            y = self.current_pos[1] + r * np.sin(phi) * np.sin(theta)
            z = self.current_pos[2] + r * np.cos(phi)
            
            voxel = Voxel(
                x=x, y=y, z=z,
                energy=0.8 + np.random.random() * 0.2,
                emotion=self.base_emotion.copy() + np.random.randn(4) * 0.05,
                trauma=0.0,
                semantic=self.semantic.copy(),
                entity_id=self.entity_id
            )
            voxel.emotion = np.clip(voxel.emotion, 0, 1)
            voxel.emotion = voxel.emotion / (np.sum(voxel.emotion) + 1e-10)
            
            self.voxels.append(voxel)
    
    def move_towards(self, target: np.ndarray, speed: float = 2.0):
        """–î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏"""
        direction = target - self.current_pos
        distance = np.linalg.norm(direction)
        
        if distance < 1.0:
            return True  # –î–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏
        
        direction = direction / distance
        movement = direction * min(speed, distance)
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –≤–æ–∫—Å–µ–ª–µ–π
        for voxel in self.voxels:
            voxel.x += movement[0]
            voxel.y += movement[1]
            voxel.z += movement[2]
        
        self.current_pos += movement
        return False
    
    def get_positions(self) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –≤–æ–∫—Å–µ–ª–µ–π"""
        return np.array([[v.x, v.y, v.z] for v in self.voxels])
    
    def get_colors(self, highlight: str = None) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π"""
        colors = []
        
        for v in self.voxels:
            if highlight == 'green':
                # –ó–µ–ª—ë–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
                r = 0.1 + v.emotion[0] * 0.2
                g = 0.7 + v.energy * 0.3
                b = 0.3
            elif highlight == 'red':
                # –ö—Ä–∞—Å–Ω–æ–µ –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ
                r = 0.8 + v.trauma * 0.2
                g = 0.1
                b = 0.1
            else:
                # –û–±—ã—á–Ω—ã–π —Ü–≤–µ—Ç
                joy, fear, anger, peace = v.emotion
                r = anger * 0.5 + fear * 0.3 + 0.3
                g = joy * 0.6 + peace * 0.3 + 0.2
                b = peace * 0.6 + 0.2
            
            colors.append([r * v.energy, g * v.energy, b * v.energy])
        
        return np.clip(np.array(colors), 0, 1)


class MetaOrganism:
    """
    –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ú–µ—Ç–∞-–û—Ä–≥–∞–Ω–∏–∑–º - –∂–∏–≤–æ–µ —Ü–∏—Ñ—Ä–æ–≤–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ.
    
    100k-1M –≤–æ–∫—Å–µ–ª–µ–π, –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π, –¥—ã—à–∞—â–∏–π, —á—É–≤—Å—Ç–≤—É—é—â–∏–π.
    """
    
    def __init__(self, num_voxels: int = 100000, center: np.ndarray = None):
        self.storage = ANIRLEStorage(resolution=1.0)
        self.center = center if center is not None else np.zeros(3)
        self.num_voxels = num_voxels
        self.radius = (num_voxels / (4/3 * np.pi)) ** (1/3) * 2
        
        # –°–æ—Å—Ç–æ—è–Ω–∏–µ
        self.state = OrganismState()
        # –ë–∞–∑–æ–≤–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –≤ [-1, 1])
        self.base_semantic = np.random.randn(8)  # –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–±—Ä–æ—Å–∞
        self.base_semantic = self.base_semantic / np.linalg.norm(self.base_semantic)
        
        # –ü—É–ª—å—Å–∞—Ü–∏—è
        self.pulse_phase = 0.0
        self.pulse_frequency = 0.5  # Hz
        self.breath_amplitude = 0.03
        
        # –ö–æ—ç–≤–æ–ª—é—Ü–∏—è (–õ–∞–≤—Ä–µ–Ω–∫–æ–≤ 2016)
        self.emotion_history: List[np.ndarray] = []
        self.global_emotion = np.array([0.4, 0.1, 0.1, 0.4])  # joy, fear, anger, peace
        
        # –ñ–∏–≤—ã–µ —Å—É—â–µ—Å—Ç–≤–∞
        self.creatures: List[FileCreature] = []
        
        # –°–æ–±—ã—Ç–∏—è
        self.on_integration: Optional[Callable] = None
        self.on_trauma: Optional[Callable] = None
        self.on_update: Optional[Callable] = None
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
        self._generate_organism()
    
    def _generate_organism(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –≤ —Ñ–æ—Ä–º–µ –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–≥–æ —à–∞—Ä–∞/–¥–µ—Ä–µ–≤–∞"""
        print(f"üß¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∏–∑ {self.num_voxels} –≤–æ–∫—Å–µ–ª–µ–π...")
        
        golden_ratio = (1 + np.sqrt(5)) / 2
        
        # –û—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ–ª–æ - —Å—Ñ–µ—Ä–∞
        main_body_count = int(self.num_voxels * 0.7)
        
        for i in range(main_body_count):
            # –§–∏–±–æ–Ω–∞—á—á–∏-—Å—Ñ–µ—Ä–∞ –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            theta = 2 * np.pi * i / golden_ratio
            phi = np.arccos(1 - 2 * (i + 0.5) / main_body_count)
            
            # –†–∞–¥–∏—É—Å —Å –≤–∞—Ä–∏–∞—Ü–∏–µ–π (–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º–∞)
            r_variation = 1.0 + 0.1 * np.sin(theta * 5) * np.cos(phi * 3)
            r = self.radius * (np.random.random() ** (1/3)) * r_variation
            
            x = self.center[0] + r * np.sin(phi) * np.cos(theta)
            y = self.center[1] + r * np.sin(phi) * np.sin(theta)
            z = self.center[2] + r * np.cos(phi)
            
            # –≠–Ω–µ—Ä–≥–∏—è –≤—ã—à–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
            distance_ratio = r / self.radius
            energy = 0.9 - distance_ratio * 0.3 + np.random.random() * 0.1
            
            # –≠–º–æ—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–∑–∏—Ü–∏–∏
            emotion = self.global_emotion.copy()
            emotion[0] += (1 - distance_ratio) * 0.2  # –ë–æ–ª—å—à–µ —Ä–∞–¥–æ—Å—Ç–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ
            emotion[3] += distance_ratio * 0.1  # –ë–æ–ª—å—à–µ –ø–æ–∫–æ—è –Ω–∞ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏
            emotion = np.clip(emotion, 0, 1)
            emotion = emotion / (np.sum(emotion) + 1e-10)
            
            voxel = Voxel(
                x=x, y=y, z=z,
                energy=energy,
                emotion=emotion,
                trauma=0.0,
                semantic=self.base_semantic.copy() + np.random.randn(8) * 0.05,
                entity_id=-1  # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º
            )
            self.storage.add(voxel)
        
        # –î–µ–Ω–¥—Ä–∏—Ç—ã - –≤–µ—Ç–≤–∏ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
        dendrite_count = self.num_voxels - main_body_count
        num_branches = 12
        voxels_per_branch = dendrite_count // num_branches
        
        for branch in range(num_branches):
            # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç–≤–∏
            branch_theta = 2 * np.pi * branch / num_branches
            branch_phi = np.pi / 4 + np.random.random() * np.pi / 2
            
            branch_dir = np.array([
                np.sin(branch_phi) * np.cos(branch_theta),
                np.sin(branch_phi) * np.sin(branch_theta),
                np.cos(branch_phi)
            ])
            
            for i in range(voxels_per_branch):
                # –ü–æ–∑–∏—Ü–∏—è –≤–¥–æ–ª—å –≤–µ—Ç–≤–∏ —Å —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–µ–π
                t = (i / voxels_per_branch) * 1.5
                spread = 0.1 + t * 0.3  # –í–µ—Ç–≤–∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è
                
                pos = self.center + branch_dir * (self.radius + t * self.radius * 0.5)
                pos += np.random.randn(3) * spread
                
                energy = 0.7 - t * 0.2 + np.random.random() * 0.1
                
                voxel = Voxel(
                    x=pos[0], y=pos[1], z=pos[2],
                    energy=max(0.3, energy),
                    emotion=self.global_emotion.copy(),
                    trauma=0.0,
                    semantic=self.base_semantic.copy(),
                    entity_id=-1
                )
                self.storage.add(voxel)
        
        self._update_state()
        print(f"‚úÖ –û—Ä–≥–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω: {len(self.storage)} –≤–æ–∫—Å–µ–ª–µ–π")
    
    def spawn_creature(self, file_path: str, file_data: bytes) -> FileCreature:
        """–°–æ–∑–¥–∞—Ç—å —Å—É—â–µ—Å—Ç–≤–æ –∏–∑ —Ñ–∞–π–ª–∞"""
        # –ü–æ–∑–∏—Ü–∏—è —Å–ø–∞–≤–Ω–∞ - —Å–ª—É—á–∞–π–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –æ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º–∞
        angle = np.random.random() * 2 * np.pi
        phi = np.random.random() * np.pi
        spawn_distance = self.radius * 3
        
        spawn_pos = self.center + np.array([
            spawn_distance * np.sin(phi) * np.cos(angle),
            spawn_distance * np.sin(phi) * np.sin(angle),
            spawn_distance * np.cos(phi)
        ])
        
        # –†–∞–∑–º–µ—Ä —Å—É—â–µ—Å—Ç–≤–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª–µ–Ω —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞
        file_size = len(file_data)
        num_voxels = min(2000, max(500, int(np.log2(file_size + 1) * 100)))
        
        creature = FileCreature(file_path, file_data, spawn_pos, num_voxels)
        creature.target_pos = self.center.copy()
        
        self.creatures.append(creature)
        self.state.last_event = f"üåü –°–æ–∑–¥–∞–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ: {file_path}"
        
        print(f"üåü –°—É—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–æ –∏–∑ {file_path}: {num_voxels} –≤–æ–∫—Å–µ–ª–µ–π")
        return creature
    
    def check_compatibility(self, creature: FileCreature) -> Tuple[float, float]:
        """
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤–∞ —Å –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º.
        
        Returns:
            (semantic_similarity, emotion_similarity)
        """
        # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
        semantic_sim = cosine_similarity(creature.semantic, self.base_semantic)
        
        # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
        emotion_sim = cosine_similarity(creature.base_emotion, self.global_emotion)
        
        return semantic_sim, emotion_sim
    
    def integrate_creature(self, creature: FileCreature):
        """
        –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤–∞ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å > 0.7).
        
        –ó–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç, +energy, —Ä–æ—Å—Ç –æ—Ä–≥–∞–Ω–∏–∑–º–∞.
        """
        print(f"üíö –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: {creature.file_path}")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∫—Å–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤–∞ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º
        for voxel in creature.voxels:
            voxel.entity_id = -1  # –¢–µ–ø–µ—Ä—å —á–∞—Å—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º–∞
            voxel.energy = min(1.0, voxel.energy + 0.2)  # –ë—É—Å—Ç —ç–Ω–µ—Ä–≥–∏–∏
            voxel.emotion[0] = min(1.0, voxel.emotion[0] + 0.3)  # –ë—É—Å—Ç —Ä–∞–¥–æ—Å—Ç–∏
            self.storage.add(voxel)
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ (–æ–±—É—á–µ–Ω–∏–µ)
        self.base_semantic = (self.base_semantic * 0.95 + creature.semantic * 0.05)
        self.base_semantic = self.base_semantic / np.linalg.norm(self.base_semantic)
        
        # –ì–ª–æ–±–∞–ª—å–Ω–∞—è —ç–º–æ—Ü–∏—è - —Ä–∞–¥–æ—Å—Ç—å
        self.global_emotion[0] = min(1.0, self.global_emotion[0] + 0.1)
        self.global_emotion = self.global_emotion / np.sum(self.global_emotion)
        
        # –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø—É–ª—å—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –≤–æ–∫—Å–µ–ª—è–º
        for voxel in self.storage:
            if voxel.entity_id == -1:
                distance = np.linalg.norm(voxel.pos - creature.current_pos)
                if distance < self.radius * 0.5:
                    voxel.energy = min(1.0, voxel.energy + 0.1)
        
        creature.integrated = True
        creature.alive = False
        self.state.integration_count += 1
        self.state.last_event = f"üíö –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: {creature.file_path}"
        self.state.mood = "–∫–∞–π—Ñ"
        self.state.mood_intensity = 0.9
        
        if self.on_integration:
            self.on_integration(creature)
        
        self._update_state()
    
    def reject_creature(self, creature: FileCreature, severity: float = 0.5):
        """
        –û—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–∞ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å < 0.4).
        
        –ü–æ –ù–∏–∫–æ–Ω–æ–≤–æ–π 2013 (—Ç—Ä–∞–≤–º–∞ —Ç–∫–∞–Ω–µ–π) –∏ –ê—Ö–º–∞–¥—É–ª–ª–∏–Ω–æ–π 2020 (–∞—Ç—Ä–æ—Ñ–∏—è).
        
        –ö—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç, +trauma, —É–¥–∞–ª–µ–Ω–∏–µ 5-20% –≤–æ–∫—Å–µ–ª–µ–π.
        """
        print(f"üî¥ –û–¢–¢–û–†–ñ–ï–ù–ò–ï: {creature.file_path} (severity={severity:.2f})")
        
        # –ü—Ä–æ—Ü–µ–Ω—Ç –∞—Ç—Ä–æ—Ñ–∏–∏ (–ø–æ –ê—Ö–º–∞–¥—É–ª–ª–∏–Ω–æ–π)
        atrophy_percent = 0.05 + severity * 0.15  # 5-20%
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–æ–Ω—É —Ç—Ä–∞–≤–º—ã - –±–ª–∏–∂–∞–π—à–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É –≤–æ–∫—Å–µ–ª–∏
        trauma_zone_radius = self.radius * 0.3
        trauma_center = creature.current_pos.copy()
        
        voxels_to_remove = []
        trauma_voxels = []
        
        for voxel in self.storage:
            if voxel.entity_id == -1:
                distance = np.linalg.norm(voxel.pos - trauma_center)
                if distance < trauma_zone_radius:
                    trauma_voxels.append((voxel, distance))
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —Ü–µ–Ω—Ç—Ä—É —Ç—Ä–∞–≤–º—ã
        trauma_voxels.sort(key=lambda x: x[1])
        
        # –£–¥–∞–ª—è–µ–º —á–∞—Å—Ç—å (–∞—Ç—Ä–æ—Ñ–∏—è)
        num_to_remove = int(len(trauma_voxels) * atrophy_percent)
        for voxel, _ in trauma_voxels[:num_to_remove]:
            voxels_to_remove.append(voxel)
        
        # –û—Å—Ç–∞–ª—å–Ω—ã–º –≤ –∑–æ–Ω–µ - —Ç—Ä–∞–≤–º–∞
        for voxel, distance in trauma_voxels[num_to_remove:]:
            trauma_amount = (1 - distance / trauma_zone_radius) * severity
            voxel.trauma = min(1.0, voxel.trauma + trauma_amount)
            voxel.emotion[1] = min(1.0, voxel.emotion[1] + 0.2)  # –°—Ç—Ä–∞—Ö
            voxel.emotion[2] = min(1.0, voxel.emotion[2] + 0.3)  # –ì–Ω–µ–≤
            voxel.emotion = voxel.emotion / np.sum(voxel.emotion)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ
        for voxel in voxels_to_remove:
            self.storage.remove(voxel.x, voxel.y, voxel.z)
        
        # –ì–ª–æ–±–∞–ª—å–Ω–∞—è —ç–º–æ—Ü–∏—è - —Å—Ç—Ä–µ—Å—Å
        self.global_emotion[1] += 0.15  # –°—Ç—Ä–∞—Ö
        self.global_emotion[2] += 0.2   # –ì–Ω–µ–≤
        self.global_emotion[0] = max(0.05, self.global_emotion[0] - 0.1)  # –ú–µ–Ω—å—à–µ —Ä–∞–¥–æ—Å—Ç–∏
        self.global_emotion = self.global_emotion / np.sum(self.global_emotion)
        
        creature.rejected = True
        creature.alive = False
        self.state.trauma_count += 1
        self.state.last_event = f"üî¥ –û—Ç—Ç–æ—Ä–≥–Ω—É—Ç–æ: {creature.file_path} ({num_to_remove} –≤–æ–∫—Å–µ–ª–µ–π –ø–æ—Ç–µ—Ä—è–Ω–æ)"
        self.state.mood = "—Ç—Ä–∞–≤–º–∞"
        self.state.mood_intensity = severity
        
        if self.on_trauma:
            self.on_trauma(creature, num_to_remove)
        
        self._update_state()
    
    def update(self, dt: float = 0.016):
        """
        –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ (–æ–¥–∏–Ω —Ç–∏–∫).
        
        –í–∫–ª—é—á–∞–µ—Ç:
        - –ü—É–ª—å—Å–∞—Ü–∏—é
        - –î–≤–∏–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤
        - –ö–æ—ç–≤–æ–ª—é—Ü–∏—é —ç–º–æ—Ü–∏–π (–õ–∞–≤—Ä–µ–Ω–∫–æ–≤ 2016)
        - –î–µ–∫–µ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
        """
        # –ü—É–ª—å—Å–∞—Ü–∏—è
        self.pulse_phase += dt * self.pulse_frequency * 2 * np.pi
        pulse = np.sin(self.pulse_phase) * self.breath_amplitude
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–∫—Å–µ–ª–µ–π
        for voxel in self.storage:
            # –ü—É–ª—å—Å–∞—Ü–∏—è - –¥—ã—Ö–∞–Ω–∏–µ
            direction = voxel.pos - self.center
            distance = np.linalg.norm(direction)
            if distance > 0.1:
                direction = direction / distance
                # –í–æ–∫—Å–µ–ª–∏ "–¥—ã—à–∞—Ç" - –¥–≤–∏–≥–∞—é—Ç—Å—è –∫/–æ—Ç —Ü–µ–Ω—Ç—Ä–∞
                voxel.x += direction[0] * pulse * (1 - distance / self.radius)
                voxel.y += direction[1] * pulse * (1 - distance / self.radius)
                voxel.z += direction[2] * pulse * (1 - distance / self.radius)
            
            # –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
            if voxel.trauma > 0:
                voxel.trauma = max(0, voxel.trauma - dt * 0.02)
            
            # –ö–æ—ç–≤–æ–ª—é—Ü–∏—è —ç–º–æ—Ü–∏–π (–¥–≤–∏–∂–µ–Ω–∏–µ –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —ç–º–æ—Ü–∏–∏)
            voxel.emotion = voxel.emotion * 0.99 + self.global_emotion * 0.01
            voxel.emotion = voxel.emotion / np.sum(voxel.emotion)
        
        # –î–≤–∏–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤ –∫ —Ü–µ–Ω—Ç—Ä—É
        creatures_to_process = []
        for creature in self.creatures:
            if creature.alive:
                reached = creature.move_towards(self.center, speed=dt * 50)
                if reached:
                    creatures_to_process.append(creature)
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ—Å—Ç–∏–≥—à–∏—Ö —Å—É—â–µ—Å—Ç–≤
        for creature in creatures_to_process:
            sem_sim, emo_sim = self.check_compatibility(creature)
            # –°–µ–º–∞–Ω—Ç–∏–∫–∞ –≤–∞–∂–Ω–µ–µ —ç–º–æ—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            combined = sem_sim * 0.7 + emo_sim * 0.3
            
            print(f"üìä –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å {creature.file_path}: sem={sem_sim:.2f}, emo={emo_sim:.2f}, combined={combined:.2f}")
            
            # –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
            emotion_diff = np.linalg.norm(creature.base_emotion - self.global_emotion)
            is_emotional_mismatch = emotion_diff > 0.5
            
            if sem_sim > 0.3 and not is_emotional_mismatch:
                # –•–æ—Ä–æ—à–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                self.integrate_creature(creature)
            elif sem_sim < 0.0 or is_emotional_mismatch:
                # –ü–ª–æ—Ö–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∏–ª–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                severity = max(0.3, 0.8 - combined)
                self.reject_creature(creature, severity=severity)
            else:
                # –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å - —á–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
                print(f"‚ö†Ô∏è –ü–æ–≥—Ä–∞–Ω–∏—á–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∏—Å–∫–æ–º")
                self.integrate_creature(creature)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤—ã—Ö —Å—É—â–µ—Å—Ç–≤ –∏–∑ —Å–ø–∏—Å–∫–∞
        self.creatures = [c for c in self.creatures if c.alive]
        
        # –ö–æ—ç–≤–æ–ª—é—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —ç–º–æ—Ü–∏–∏ (–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–∫–æ—é)
        self.global_emotion[3] = min(1.0, self.global_emotion[3] + dt * 0.01)
        self.global_emotion = self.global_emotion / np.sum(self.global_emotion)
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        self._update_state()
        self.storage.tick += 1
        
        if self.on_update:
            self.on_update(self.state)
    
    def _update_state(self):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
        stats = self.storage.get_statistics()
        
        self.state.total_voxels = stats['total_voxels']
        self.state.alive_voxels = stats['alive_voxels']
        self.state.memory_saved = stats['memory_saved_percent']
        
        # –ó–¥–æ—Ä–æ–≤—å–µ = —Å—Ä–µ–¥–Ω–µ–µ –æ—Ç —ç–Ω–µ—Ä–≥–∏–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–∞–≤–º—ã
        if stats['total_voxels'] > 0:
            self.state.health = (stats['avg_energy'] + (1 - stats['avg_trauma'])) / 2
        else:
            self.state.health = 0
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
        dominant_idx = np.argmax(self.global_emotion)
        moods = ['–∫–∞–π—Ñ', '—Ç—Ä–µ–≤–æ–≥–∞', '–≥–Ω–µ–≤', '–ø–æ–∫–æ–π']
        self.state.mood = moods[dominant_idx]
        self.state.mood_intensity = self.global_emotion[dominant_idx]
    
    def get_all_positions(self) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ (–æ—Ä–≥–∞–Ω–∏–∑–º + —Å—É—â–µ—Å—Ç–≤–∞)"""
        org_pos = self.storage.get_all_positions()
        
        creature_positions = []
        for creature in self.creatures:
            if creature.alive:
                creature_positions.append(creature.get_positions())
        
        if creature_positions:
            all_positions = np.vstack([org_pos] + creature_positions)
        else:
            all_positions = org_pos
        
        return all_positions
    
    def get_all_colors(self) -> np.ndarray:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ü–≤–µ—Ç–∞"""
        org_colors = self.storage.get_all_colors()
        
        creature_colors = []
        for creature in self.creatures:
            if creature.alive:
                # –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è
                distance = np.linalg.norm(creature.current_pos - self.center)
                if distance < self.radius * 1.5:
                    sem_sim, emo_sim = self.check_compatibility(creature)
                    combined = (sem_sim + emo_sim) / 2
                    if combined > 0.5:
                        highlight = 'green'
                    elif combined < 0.35:
                        highlight = 'red'
                    else:
                        highlight = None
                else:
                    highlight = None
                creature_colors.append(creature.get_colors(highlight))
        
        if creature_colors:
            all_colors = np.vstack([org_colors] + creature_colors)
        else:
            all_colors = org_colors
        
        return all_colors



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: visualizer.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
"""
CrimeaAI Meta Organism - Real-time Visualization
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ Open3D –∏ Plotly.
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–∞ —Ç–æ—á–µ–∫ –±–µ–∑ –ª–∞–≥–æ–≤.

LightPattern 1KB - –æ—Å–≤–µ—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç energy/emotion.
"""

import numpy as np
from typing import Optional, Dict, Callable, Tuple
import threading
import time

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Open3D
try:
    import open3d as o3d
    HAS_OPEN3D = True
except ImportError:
    HAS_OPEN3D = False
    print("‚ö†Ô∏è Open3D –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Plotly")

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Plotly
try:
    import plotly.graph_objects as go
    from plotly.subplots import make_subplots
    HAS_PLOTLY = True
except ImportError:
    HAS_PLOTLY = False
    print("‚ö†Ô∏è Plotly –Ω–µ –Ω–∞–π–¥–µ–Ω")

# Matplotlib –∫–∞–∫ fallback
try:
    import matplotlib.pyplot as plt
    from mpl_toolkits.mplot3d import Axes3D
    HAS_MATPLOTLIB = True
except ImportError:
    HAS_MATPLOTLIB = False


class LightPattern1KB:
    """
    LightPattern 1KB - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Å–≤–µ—â–µ–Ω–∏—è.
    
    –û—Å–≤–µ—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
    - energy –≤–æ–∫—Å–µ–ª–µ–π
    - emotion (—Ä–∞–¥–æ—Å—Ç—å = —è—Ä–∫–æ—Å—Ç—å, —Å—Ç—Ä–∞—Ö = –º–µ—Ä—Ü–∞–Ω–∏–µ, –≥–Ω–µ–≤ = –∫—Ä–∞—Å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ)
    - trauma (–∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ + –∫—Ä–∞—Å–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫)
    """
    
    def __init__(self):
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å–≤–µ—â–µ–Ω–∏—è (–ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ 1KB)
        self.ambient = 0.3
        self.diffuse = 0.6
        self.specular = 0.2
        self.light_pos = np.array([100.0, 100.0, 100.0])
        
        # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        self.joy_brightness = 1.2
        self.fear_flicker_rate = 5.0
        self.anger_red_boost = 0.4
        self.peace_blue_tint = 0.2
        
        # –í—Ä–µ–º—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        self.time = 0.0
    
    def compute_lighting(self, positions: np.ndarray, colors: np.ndarray,
                        emotions: np.ndarray, energies: np.ndarray,
                        traumas: np.ndarray) -> np.ndarray:
        """
        –í—ã—á–∏—Å–ª–∏—Ç—å –æ—Å–≤–µ—â—ë–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –≤–æ–∫—Å–µ–ª–µ–π.
        
        Args:
            positions: (N, 3) –ø–æ–∑–∏—Ü–∏–∏ –≤–æ–∫—Å–µ–ª–µ–π
            colors: (N, 3) –±–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
            emotions: (N, 4) —ç–º–æ—Ü–∏–∏ [joy, fear, anger, peace]
            energies: (N,) —ç–Ω–µ—Ä–≥–∏—è –≤–æ–∫—Å–µ–ª–µ–π
            traumas: (N,) —Ç—Ä–∞–≤–º—ã –≤–æ–∫—Å–µ–ª–µ–π
        
        Returns:
            (N, 3) –æ—Å–≤–µ—â—ë–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞
        """
        if len(positions) == 0:
            return colors
        
        N = len(positions)
        
        # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ —Å–≤–µ—Ç—É
        light_dirs = self.light_pos - positions
        light_dists = np.linalg.norm(light_dirs, axis=1, keepdims=True) + 1e-10
        light_dirs = light_dirs / light_dists
        
        # –ü—Ä–æ—Å—Ç–æ–µ –¥–∏—Ñ—Ñ—É–∑–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
        # –ù–æ—Ä–º–∞–ª—å = –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ (–¥–ª—è —Å—Ñ–µ—Ä—ã)
        center = np.mean(positions, axis=0)
        normals = positions - center
        normal_lens = np.linalg.norm(normals, axis=1, keepdims=True) + 1e-10
        normals = normals / normal_lens
        
        diffuse = np.maximum(0, np.sum(normals * light_dirs, axis=1))
        
        # –ë–∞–∑–æ–≤–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
        lighting = self.ambient + self.diffuse * diffuse
        
        # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
        joy = emotions[:, 0]
        fear = emotions[:, 1]
        anger = emotions[:, 2]
        peace = emotions[:, 3]
        
        # –†–∞–¥–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —è—Ä–∫–æ—Å—Ç—å
        lighting = lighting * (1.0 + joy * (self.joy_brightness - 1.0))
        
        # –°—Ç—Ä–∞—Ö –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏–µ
        flicker = 0.5 + 0.5 * np.sin(self.time * self.fear_flicker_rate + 
                                      np.arange(N) * 0.1)
        lighting = lighting * (1.0 - fear * 0.3 * flicker)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ –∫ —Ü–≤–µ—Ç–∞–º
        lit_colors = colors * lighting[:, np.newaxis]
        
        # –ì–Ω–µ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Å–Ω—ã–π
        lit_colors[:, 0] = np.minimum(1.0, lit_colors[:, 0] + anger * self.anger_red_boost)
        
        # –ü–æ–∫–æ–π –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∏–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫
        lit_colors[:, 2] = np.minimum(1.0, lit_colors[:, 2] + peace * self.peace_blue_tint)
        
        # –¢—Ä–∞–≤–º–∞ –∑–∞—Ç–µ–º–Ω—è–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Å–Ω—ã–π
        trauma_factor = 1.0 - traumas * 0.5
        lit_colors = lit_colors * trauma_factor[:, np.newaxis]
        lit_colors[:, 0] = np.minimum(1.0, lit_colors[:, 0] + traumas * 0.3)
        
        # –≠–Ω–µ—Ä–≥–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â—É—é —è—Ä–∫–æ—Å—Ç—å
        lit_colors = lit_colors * energies[:, np.newaxis]
        
        return np.clip(lit_colors, 0, 1)
    
    def update(self, dt: float):
        """–û–±–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏"""
        self.time += dt


class Open3DVisualizer:
    """
    –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–∞ Open3D - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–∞ —Ç–æ—á–µ–∫.
    """
    
    def __init__(self, window_name: str = "CrimeaAI Meta Organism"):
        if not HAS_OPEN3D:
            raise ImportError("Open3D –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        self.window_name = window_name
        self.vis = None
        self.pcd = None
        self.running = False
        self.light_pattern = LightPattern1KB()
        
    def initialize(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞"""
        self.vis = o3d.visualization.Visualizer()
        self.vis.create_window(window_name=self.window_name, width=1280, height=720)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        render_opt = self.vis.get_render_option()
        render_opt.background_color = np.array([0.02, 0.02, 0.05])  # –¢—ë–º–Ω—ã–π –∫–æ—Å–º–æ—Å
        render_opt.point_size = 2.0
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞–∫–∞ —Ç–æ—á–µ–∫
        self.pcd = o3d.geometry.PointCloud()
        self.vis.add_geometry(self.pcd)
        
        self.running = True
    
    def update(self, positions: np.ndarray, colors: np.ndarray,
               emotions: Optional[np.ndarray] = None,
               energies: Optional[np.ndarray] = None,
               traumas: Optional[np.ndarray] = None,
               dt: float = 0.016):
        """–û–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é"""
        if not self.running or self.pcd is None:
            return False
        
        if len(positions) == 0:
            return True
        
        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
        if emotions is not None and energies is not None and traumas is not None:
            self.light_pattern.update(dt)
            colors = self.light_pattern.compute_lighting(
                positions, colors, emotions, energies, traumas
            )
        
        # –û–±–Ω–æ–≤–∏—Ç—å –æ–±–ª–∞–∫–æ —Ç–æ—á–µ–∫
        self.pcd.points = o3d.utility.Vector3dVector(positions)
        self.pcd.colors = o3d.utility.Vector3dVector(colors)
        
        # –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é
        self.vis.update_geometry(self.pcd)
        self.vis.poll_events()
        self.vis.update_renderer()
        
        return True
    
    def close(self):
        """–ó–∞–∫—Ä—ã—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä"""
        self.running = False
        if self.vis:
            self.vis.destroy_window()


class PlotlyVisualizer:
    """
    –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–∞ Plotly - –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ downsampling –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.
    """
    
    def __init__(self, max_points: int = 50000):
        if not HAS_PLOTLY:
            raise ImportError("Plotly –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        self.max_points = max_points
        self.fig = None
        self.light_pattern = LightPattern1KB()
    
    def create_figure(self, positions: np.ndarray, colors: np.ndarray,
                     title: str = "CrimeaAI Meta Organism",
                     emotions: Optional[np.ndarray] = None,
                     energies: Optional[np.ndarray] = None,
                     traumas: Optional[np.ndarray] = None) -> go.Figure:
        """–°–æ–∑–¥–∞—Ç—å —Ñ–∏–≥—É—Ä—É Plotly"""
        
        # Downsampling –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫
        if len(positions) > self.max_points:
            indices = np.random.choice(len(positions), self.max_points, replace=False)
            positions = positions[indices]
            colors = colors[indices]
            if emotions is not None:
                emotions = emotions[indices]
            if energies is not None:
                energies = energies[indices]
            if traumas is not None:
                traumas = traumas[indices]
        
        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ
        if emotions is not None and energies is not None and traumas is not None:
            colors = self.light_pattern.compute_lighting(
                positions, colors, emotions, energies, traumas
            )
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç Plotly
        color_strings = [f'rgb({int(r*255)},{int(g*255)},{int(b*255)})' 
                        for r, g, b in colors]
        
        # –°–æ–∑–¥–∞–Ω–∏–µ scatter3d
        scatter = go.Scatter3d(
            x=positions[:, 0],
            y=positions[:, 1],
            z=positions[:, 2],
            mode='markers',
            marker=dict(
                size=2,
                color=color_strings,
                opacity=0.8
            ),
            hoverinfo='none'
        )
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã
        self.fig = go.Figure(data=[scatter])
        
        self.fig.update_layout(
            title=dict(
                text=title,
                font=dict(size=24, color='white')
            ),
            scene=dict(
                xaxis=dict(showbackground=False, showgrid=False, zeroline=False, visible=False),
                yaxis=dict(showbackground=False, showgrid=False, zeroline=False, visible=False),
                zaxis=dict(showbackground=False, showgrid=False, zeroline=False, visible=False),
                bgcolor='rgb(5, 5, 15)'
            ),
            paper_bgcolor='rgb(5, 5, 15)',
            plot_bgcolor='rgb(5, 5, 15)',
            margin=dict(l=0, r=0, t=50, b=0)
        )
        
        return self.fig
    
    def show(self):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–≥—É—Ä—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ"""
        if self.fig:
            self.fig.show()
    
    def save_html(self, path: str):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ HTML —Ñ–∞–π–ª"""
        if self.fig:
            self.fig.write_html(path)


class MatplotlibVisualizer:
    """
    –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–∞ Matplotlib - fallback –≤–∞—Ä–∏–∞–Ω—Ç.
    """
    
    def __init__(self, max_points: int = 20000):
        if not HAS_MATPLOTLIB:
            raise ImportError("Matplotlib –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        self.max_points = max_points
        self.fig = None
        self.ax = None
        self.scatter = None
        self.light_pattern = LightPattern1KB()
        
    def initialize(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"""
        plt.ion()
        self.fig = plt.figure(figsize=(12, 8), facecolor='#050510')
        self.ax = self.fig.add_subplot(111, projection='3d', facecolor='#050510')
        
        # –£–±—Ä–∞—Ç—å –æ—Å–∏
        self.ax.set_axis_off()
        
        plt.tight_layout()
        plt.show(block=False)
    
    def update(self, positions: np.ndarray, colors: np.ndarray,
               title: str = "",
               emotions: Optional[np.ndarray] = None,
               energies: Optional[np.ndarray] = None,
               traumas: Optional[np.ndarray] = None,
               dt: float = 0.016):
        """–û–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é"""
        
        # Downsampling
        if len(positions) > self.max_points:
            indices = np.random.choice(len(positions), self.max_points, replace=False)
            positions = positions[indices]
            colors = colors[indices]
            if emotions is not None:
                emotions = emotions[indices]
            if energies is not None:
                energies = energies[indices]
            if traumas is not None:
                traumas = traumas[indices]
        
        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ
        if emotions is not None and energies is not None and traumas is not None:
            self.light_pattern.update(dt)
            colors = self.light_pattern.compute_lighting(
                positions, colors, emotions, energies, traumas
            )
        
        self.ax.clear()
        self.ax.set_axis_off()
        self.ax.set_facecolor('#050510')
        
        if len(positions) > 0:
            self.ax.scatter(
                positions[:, 0],
                positions[:, 1],
                positions[:, 2],
                c=colors,
                s=1,
                alpha=0.8
            )
        
        if title:
            self.ax.set_title(title, color='white', fontsize=14)
        
        self.fig.canvas.draw()
        self.fig.canvas.flush_events()
    
    def close(self):
        """–ó–∞–∫—Ä—ã—Ç—å"""
        plt.close(self.fig)


def create_visualizer(backend: str = 'auto'):
    """
    –°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –±—ç–∫–µ–Ω–¥–∞.
    
    Args:
        backend: 'open3d', 'plotly', 'matplotlib', –∏–ª–∏ 'auto'
    
    Returns:
        –≠–∫–∑–µ–º–ø–ª—è—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
    """
    if backend == 'auto':
        if HAS_OPEN3D:
            return Open3DVisualizer()
        elif HAS_PLOTLY:
            return PlotlyVisualizer()
        elif HAS_MATPLOTLIB:
            return MatplotlibVisualizer()
        else:
            raise ImportError("–ù–∏ –æ–¥–∏–Ω –∏–∑ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω")
    
    elif backend == 'open3d':
        return Open3DVisualizer()
    elif backend == 'plotly':
        return PlotlyVisualizer()
    elif backend == 'matplotlib':
        return MatplotlibVisualizer()
    else:
        raise ValueError(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—ç–∫–µ–Ω–¥: {backend}")



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: demo.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#!/usr/bin/env python3
"""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                   CrimeaAI META ORGANISM - –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø                       ‚ïë
‚ïë                        30-—Å–µ–∫—É–Ω–¥–Ω—ã–π –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç 30-—Å–µ–∫—É–Ω–¥–Ω—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é:
1. –°–æ–∑–¥–∞—ë—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º (–ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π —à–∞—Ä)
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è "—Ñ–∞–π–ª—ã" —Ä–∞–∑–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∑–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç) –∏ —Ç—Ä–∞–≤–º–∞ (–∫—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç)
4. –í—ã–≤–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä
"""

import os
import sys
import time
import numpy as np
import threading
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from voxel_core import Voxel, compute_semantic_fingerprint
from organism import MetaOrganism, FileCreature

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
HAS_OPEN3D = False
HAS_PLOTLY = False
HAS_MATPLOTLIB = False

try:
    import open3d as o3d
    HAS_OPEN3D = True
except ImportError:
    pass

try:
    import plotly.graph_objects as go
    HAS_PLOTLY = True
except ImportError:
    pass

try:
    import matplotlib.pyplot as plt
    from mpl_toolkits.mplot3d import Axes3D
    HAS_MATPLOTLIB = True
except ImportError:
    pass


class DemoRunner:
    """–ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è"""
    
    def __init__(self, num_voxels: int = 30000):
        self.num_voxels = num_voxels
        self.organism = None
        self.running = False
        self.demo_time = 30.0  # 30 —Å–µ–∫—É–Ω–¥
        self.start_time = 0
        
    def generate_synthetic_file(self, compatibility: float) -> bytes:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é.
        
        Args:
            compatibility: 0.0 = –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π, 1.0 = –∏–¥–µ–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π
        """
        # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä)
        org_semantic = self.organism.base_semantic
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–¥—É—Ç –Ω—É–∂–Ω—É—é —Å–µ–º–∞–Ω—Ç–∏–∫—É
        size = np.random.randint(5000, 50000)
        
        if compatibility > 0.7:
            # –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–∞–π–ª - —Å–æ–∑–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ —Å –ø–æ—Ö–æ–∂–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            # –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
            target_mean = (org_semantic[4] + 1) / 2 * 255  # –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
            target_std = (org_semantic[5] + 1) * 64
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å –Ω—É–∂–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            data = np.random.normal(target_mean, target_std, size)
            data = np.clip(data, 0, 255).astype(np.uint8)
            
        elif compatibility < 0.3:
            # –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–∞–π–ª - –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            # –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            target_mean = 255 - ((org_semantic[4] + 1) / 2 * 255)
            target_std = 128 - (org_semantic[5] + 1) * 64
            target_std = max(10, target_std)
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            data = np.random.normal(target_mean, target_std, size)
            data = np.clip(data, 0, 255).astype(np.uint8)
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–ª–∏—á–∏—è
            for i in range(0, len(data) - 100, 100):
                if np.random.random() > 0.5:
                    data[i:i+50] = 0
                else:
                    data[i:i+50] = 255
        else:
            # –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–π–ª - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
            data = np.random.randint(0, 256, size, dtype=np.uint8)
        
        return data.tobytes()
    
    def run_demo_open3d(self):
        """–î–µ–º–æ —Å Open3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π"""
        print("üé® –ó–∞–ø—É—Å–∫ Open3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏...")
        
        vis = o3d.visualization.Visualizer()
        vis.create_window(window_name="CrimeaAI Meta Organism Demo", width=1280, height=720)
        
        render_opt = vis.get_render_option()
        render_opt.background_color = np.array([0.02, 0.02, 0.05])
        render_opt.point_size = 2.0
        
        pcd = o3d.geometry.PointCloud()
        vis.add_geometry(pcd)
        
        self.running = True
        self.start_time = time.time()
        
        # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        events = [
            (2.0, 0.9, "compatible_1.py"),     # –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–∞–π–ª
            (6.0, 0.2, "malware.exe"),          # –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–∞–π–ª
            (10.0, 0.85, "module.py"),          # –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π
            (14.0, 0.15, "virus.bin"),          # –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π
            (18.0, 0.75, "data.json"),          # –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π
            (22.0, 0.95, "library.py"),         # –û—á–µ–Ω—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π
            (26.0, 0.1, "threat.dll"),          # –û—á–µ–Ω—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π
        ]
        events_spawned = [False] * len(events)
        
        last_time = time.time()
        
        while self.running:
            current_time = time.time()
            elapsed = current_time - self.start_time
            dt = current_time - last_time
            last_time = current_time
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–º–æ
            if elapsed > self.demo_time:
                break
            
            # –°–ø–∞–≤–Ω —Å—É—â–µ—Å—Ç–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
            for i, (event_time, compat, name) in enumerate(events):
                if not events_spawned[i] and elapsed >= event_time:
                    events_spawned[i] = True
                    data = self.generate_synthetic_file(compat)
                    self.organism.spawn_creature(name, data)
                    
                    compat_str = "üíö –°–û–í–ú–ï–°–¢–ò–ú–´–ô" if compat > 0.5 else "üî¥ –ù–ï–°–û–í–ú–ï–°–¢–ò–ú–´–ô"
                    print(f"[{elapsed:.1f}s] {compat_str}: {name}")
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
            self.organism.update(dt)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            positions = self.organism.get_all_positions()
            colors = self.organism.get_all_colors()
            
            if len(positions) > 0:
                pcd.points = o3d.utility.Vector3dVector(positions)
                pcd.colors = o3d.utility.Vector3dVector(colors)
                vis.update_geometry(pcd)
            
            vis.poll_events()
            vis.update_renderer()
            
            # –í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞
            state = self.organism.state
            status = f"[{elapsed:.1f}s] Health: {state.health*100:.0f}% | Mood: {state.mood} | Voxels: {len(self.organism.storage):,}"
            print(f"\r{status}", end="", flush=True)
            
            time.sleep(0.016)  # ~60 FPS
        
        print("\n\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        vis.destroy_window()
    
    def run_demo_matplotlib(self):
        """–î–µ–º–æ —Å Matplotlib –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π"""
        print("üé® –ó–∞–ø—É—Å–∫ Matplotlib –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏...")
        
        plt.ion()
        fig = plt.figure(figsize=(14, 10), facecolor='#050510')
        
        # 3D –≥—Ä–∞—Ñ–∏–∫
        ax = fig.add_subplot(121, projection='3d', facecolor='#050510')
        ax.set_axis_off()
        
        # –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞
        ax_status = fig.add_subplot(122, facecolor='#050510')
        ax_status.set_xlim(0, 10)
        ax_status.set_ylim(0, 10)
        ax_status.axis('off')
        
        plt.tight_layout()
        plt.show(block=False)
        
        self.running = True
        self.start_time = time.time()
        
        # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        events = [
            (2.0, 0.9, "compatible_1.py"),
            (5.0, 0.2, "malware.exe"),
            (8.0, 0.85, "module.py"),
            (11.0, 0.15, "virus.bin"),
            (14.0, 0.75, "data.json"),
            (17.0, 0.95, "library.py"),
            (20.0, 0.1, "threat.dll"),
            (24.0, 0.8, "config.yaml"),
        ]
        events_spawned = [False] * len(events)
        
        max_points = 15000  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        last_time = time.time()
        frame_count = 0
        
        while self.running:
            current_time = time.time()
            elapsed = current_time - self.start_time
            dt = current_time - last_time
            last_time = current_time
            frame_count += 1
            
            if elapsed > self.demo_time:
                break
            
            # –°–ø–∞–≤–Ω —Å—É—â–µ—Å—Ç–≤
            for i, (event_time, compat, name) in enumerate(events):
                if not events_spawned[i] and elapsed >= event_time:
                    events_spawned[i] = True
                    data = self.generate_synthetic_file(compat)
                    self.organism.spawn_creature(name, data)
                    
                    compat_str = "üíö –°–û–í–ú–ï–°–¢–ò–ú–´–ô" if compat > 0.5 else "üî¥ –ù–ï–°–û–í–ú–ï–°–¢–ò–ú–´–ô"
                    print(f"[{elapsed:.1f}s] {compat_str}: {name}")
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
            self.organism.update(dt)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–π 3-–π –∫–∞–¥—Ä –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
            if frame_count % 3 == 0:
                positions = self.organism.get_all_positions()
                colors = self.organism.get_all_colors()
                
                # Downsampling
                if len(positions) > max_points:
                    indices = np.random.choice(len(positions), max_points, replace=False)
                    positions = positions[indices]
                    colors = colors[indices]
                
                ax.clear()
                ax.set_axis_off()
                ax.set_facecolor('#050510')
                
                if len(positions) > 0:
                    ax.scatter(
                        positions[:, 0],
                        positions[:, 1],
                        positions[:, 2],
                        c=colors,
                        s=1,
                        alpha=0.8
                    )
                
                # –°—Ç–∞—Ç—É—Å
                ax_status.clear()
                ax_status.set_xlim(0, 10)
                ax_status.set_ylim(0, 10)
                ax_status.axis('off')
                ax_status.set_facecolor('#050510')
                
                state = self.organism.state
                
                # –ó–∞–≥–æ–ª–æ–≤–æ–∫
                ax_status.text(5, 9, "üß¨ CrimeaAI Meta Organism", 
                              ha='center', fontsize=14, color='#00ff88', fontweight='bold')
                
                # –°—Ç–∞—Ç—É—Å
                health_color = '#00ff88' if state.health > 0.7 else '#ffaa00' if state.health > 0.4 else '#ff4444'
                mood_colors = {'–∫–∞–π—Ñ': '#00ff88', '—Ç—Ä–µ–≤–æ–≥–∞': '#ffaa00', '–≥–Ω–µ–≤': '#ff4444', '–ø–æ–∫–æ–π': '#4488ff'}
                
                status_text = f"""
                Time: {elapsed:.1f}s / {self.demo_time}s
                
                Organism Health: {state.health*100:.1f}%
                Total Voxels: {state.total_voxels:,}
                Memory Saved: {state.memory_saved:.1f}%
                
                Current Mood: {state.mood}
                Mood Intensity: {state.mood_intensity*100:.0f}%
                
                Integrations: {state.integration_count}
                Traumas: {state.trauma_count}
                
                {state.last_event}
                """
                
                ax_status.text(0.5, 7, status_text, fontsize=10, color='#aaaacc',
                              verticalalignment='top', family='monospace')
                
                # –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                progress = elapsed / self.demo_time
                ax_status.barh(0.5, progress * 9, height=0.3, color='#00ff88', alpha=0.7)
                ax_status.barh(0.5, 9, height=0.3, color='#333355', alpha=0.3)
                
                fig.canvas.draw()
                fig.canvas.flush_events()
            
            time.sleep(0.016)
        
        print("\n\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        plt.ioff()
        plt.show()
    
    def run_demo_plotly(self):
        """–î–µ–º–æ —Å Plotly (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å–Ω–∏–º–∫–∏)"""
        print("üé® –ó–∞–ø—É—Å–∫ Plotly –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
        print("‚ö†Ô∏è Plotly –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å–Ω–∏–º–∫–∏, –¥–ª—è real-time –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Open3D –∏–ª–∏ Matplotlib")
        
        self.running = True
        self.start_time = time.time()
        
        # –°–∏–º—É–ª—è—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
        events = [
            (1.0, 0.9, "compatible.py"),
            (2.0, 0.2, "malware.exe"),
            (3.0, 0.85, "module.py"),
            (4.0, 0.15, "virus.bin"),
        ]
        
        print("\nüé¨ –°–∏–º—É–ª—è—Ü–∏—è —Å–æ–±—ã—Ç–∏–π...")
        
        for event_time, compat, name in events:
            data = self.generate_synthetic_file(compat)
            self.organism.spawn_creature(name, data)
            
            compat_str = "üíö –°–û–í–ú–ï–°–¢–ò–ú–´–ô" if compat > 0.5 else "üî¥ –ù–ï–°–û–í–ú–ï–°–¢–ò–ú–´–ô"
            print(f"  {compat_str}: {name}")
            
            # –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            for _ in range(60):  # ~1 —Å–µ–∫—É–Ω–¥–∞
                self.organism.update(0.016)
            
            time.sleep(0.1)
        
        # –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫
        print("\nüì∏ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–Ω–∏–º–∫–∞...")
        
        positions = self.organism.get_all_positions()
        colors = self.organism.get_all_colors()
        
        # Downsampling –¥–ª—è Plotly
        max_points = 30000
        if len(positions) > max_points:
            indices = np.random.choice(len(positions), max_points, replace=False)
            positions = positions[indices]
            colors = colors[indices]
        
        color_strings = [f'rgb({int(r*255)},{int(g*255)},{int(b*255)})' 
                        for r, g, b in colors]
        
        state = self.organism.state
        
        fig = go.Figure(data=[go.Scatter3d(
            x=positions[:, 0],
            y=positions[:, 1],
            z=positions[:, 2],
            mode='markers',
            marker=dict(
                size=2,
                color=color_strings,
                opacity=0.8
            ),
            hoverinfo='none'
        )])
        
        fig.update_layout(
            title=dict(
                text=f"üß¨ CrimeaAI Meta Organism | Health: {state.health*100:.0f}% | Mood: {state.mood}",
                font=dict(size=20, color='white')
            ),
            scene=dict(
                xaxis=dict(showbackground=False, showgrid=False, visible=False),
                yaxis=dict(showbackground=False, showgrid=False, visible=False),
                zaxis=dict(showbackground=False, showgrid=False, visible=False),
                bgcolor='rgb(5, 5, 15)'
            ),
            paper_bgcolor='rgb(5, 5, 15)',
            plot_bgcolor='rgb(5, 5, 15)',
            margin=dict(l=0, r=0, t=60, b=0)
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º HTML
        output_path = Path(__file__).parent / "demo_output.html"
        fig.write_html(str(output_path))
        print(f"üíæ –°–Ω–∏–º–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_path}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º
        fig.show()
        
        print("\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    
    def run_demo_console(self):
        """–î–µ–º–æ –≤ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (–±–µ–∑ –≥—Ä–∞—Ñ–∏–∫–∏)"""
        print("üìü –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è (ASCII-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)")
        print("=" * 60)
        
        self.running = True
        self.start_time = time.time()
        
        events = [
            (1.0, 0.9, "compatible.py"),
            (3.0, 0.2, "malware.exe"),
            (5.0, 0.85, "module.py"),
            (7.0, 0.15, "virus.bin"),
            (9.0, 0.75, "data.json"),
        ]
        events_idx = 0
        
        last_time = time.time()
        
        while self.running:
            current_time = time.time()
            elapsed = current_time - self.start_time
            dt = current_time - last_time
            last_time = current_time
            
            if elapsed > 15:  # –ö–æ—Ä–æ—Ç–∫–∞—è –¥–µ–º–æ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
                break
            
            # –°–ø–∞–≤–Ω —Å—É—â–µ—Å—Ç–≤
            if events_idx < len(events) and elapsed >= events[events_idx][0]:
                event_time, compat, name = events[events_idx]
                events_idx += 1
                
                data = self.generate_synthetic_file(compat)
                self.organism.spawn_creature(name, data)
                
                symbol = "üíö" if compat > 0.5 else "üî¥"
                print(f"\n{symbol} –ù–æ–≤–æ–µ —Å—É—â–µ—Å—Ç–≤–æ: {name}")
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            self.organism.update(dt)
            
            # –í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞
            state = self.organism.state
            
            # ASCII –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–¥–æ—Ä–æ–≤—å—è
            health_bar_len = 20
            health_filled = int(state.health * health_bar_len)
            health_bar = "‚ñà" * health_filled + "‚ñë" * (health_bar_len - health_filled)
            
            # ASCII mood indicator
            mood_symbols = {'–∫–∞–π—Ñ': 'üòä', '—Ç—Ä–µ–≤–æ–≥–∞': 'üò∞', '–≥–Ω–µ–≤': 'üò†', '–ø–æ–∫–æ–π': 'üòå'}
            mood_sym = mood_symbols.get(state.mood, 'ü§î')
            
            status = (
                f"\r[{elapsed:5.1f}s] "
                f"Health: [{health_bar}] {state.health*100:5.1f}% | "
                f"Mood: {mood_sym} {state.mood:6} | "
                f"Voxels: {state.total_voxels:6,} | "
                f"Int: {state.integration_count} | Trauma: {state.trauma_count}"
            )
            print(status, end="", flush=True)
            
            time.sleep(0.1)
        
        print("\n\n‚úÖ –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        
        # –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        state = self.organism.state
        print(f"""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê                       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  –ó–¥–æ—Ä–æ–≤—å–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞:  {state.health*100:6.1f}%                           ‚ïë
‚ïë  –í—Å–µ–≥–æ –≤–æ–∫—Å–µ–ª–µ–π:      {state.total_voxels:6,}                            ‚ïë
‚ïë  –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏:     {state.memory_saved:6.1f}%                           ‚ïë
‚ïë  –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:          {state.mood:6}                             ‚ïë
‚ïë  –£—Å–ø–µ—à–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π: {state.integration_count:6}                            ‚ïë
‚ïë  –¢—Ä–∞–≤–º:               {state.trauma_count:6}                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        """)
    
    def run(self):
        """–ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏"""
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                   CrimeaAI META ORGANISM - –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø                       ‚ïë
‚ïë                       üß¨ –ñ–∏–≤–æ–µ –¶–∏—Ñ—Ä–æ–≤–æ–µ –°–æ–∑–Ω–∞–Ω–∏–µ üß¨                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        """)
        
        print(f"üß¨ –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ ({self.num_voxels} –≤–æ–∫—Å–µ–ª–µ–π)...")
        self.organism = MetaOrganism(num_voxels=self.num_voxels)
        
        # –í—ã–±–æ—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        print("\nüîç –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤...")
        print(f"   Open3D:    {'‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' if HAS_OPEN3D else '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω'}")
        print(f"   Plotly:    {'‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' if HAS_PLOTLY else '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω'}")
        print(f"   Matplotlib: {'‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' if HAS_MATPLOTLIB else '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω'}")
        
        if HAS_OPEN3D:
            print("\nüöÄ –ó–∞–ø—É—Å–∫ Open3D –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (real-time)...")
            self.run_demo_open3d()
        elif HAS_MATPLOTLIB:
            print("\nüöÄ –ó–∞–ø—É—Å–∫ Matplotlib –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
            self.run_demo_matplotlib()
        elif HAS_PLOTLY:
            print("\nüöÄ –ó–∞–ø—É—Å–∫ Plotly –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
            self.run_demo_plotly()
        else:
            print("\nüöÄ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
            self.run_demo_console()


def main():
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞"""
    import argparse
    
    parser = argparse.ArgumentParser(description="CrimeaAI Meta Organism - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è")
    parser.add_argument('--voxels', '-v', type=int, default=30000,
                       help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∫—Å–µ–ª–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30000)')
    parser.add_argument('--backend', '-b', choices=['auto', 'open3d', 'matplotlib', 'plotly', 'console'],
                       default='auto', help='–ë—ç–∫–µ–Ω–¥ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏')
    
    args = parser.parse_args()
    
    demo = DemoRunner(num_voxels=args.voxels)
    
    if args.backend == 'open3d' and HAS_OPEN3D:
        demo.organism = MetaOrganism(num_voxels=args.voxels)
        demo.run_demo_open3d()
    elif args.backend == 'matplotlib' and HAS_MATPLOTLIB:
        demo.organism = MetaOrganism(num_voxels=args.voxels)
        demo.run_demo_matplotlib()
    elif args.backend == 'plotly' and HAS_PLOTLY:
        demo.organism = MetaOrganism(num_voxels=args.voxels)
        demo.run_demo_plotly()
    elif args.backend == 'console':
        demo.organism = MetaOrganism(num_voxels=args.voxels)
        demo.run_demo_console()
    else:
        demo.run()


if __name__ == "__main__":
    main()



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: main.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#!/usr/bin/env python3
"""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     CrimeaAI META ORGANISM                                    ‚ïë
‚ïë                   –ñ–∏–≤–æ–µ –¶–∏—Ñ—Ä–æ–≤–æ–µ –°–æ–∑–Ω–∞–Ω–∏–µ                                    ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  Based on 7 forgotten Russian scientific works:                              ‚ïë
‚ïë  ‚Ä¢ –ù–∏–∫–æ–Ω–æ–≤–∞ 2013 - –¢—Ä–∞–≤–º–∞ —Ç–∫–∞–Ω–µ–π                                            ‚ïë
‚ïë  ‚Ä¢ –ë–∏–º–∞–∫–æ–≤ 2013 - –í–æ–∫—Å–µ–ª—å–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å                                    ‚ïë
‚ïë  ‚Ä¢ –ê—Ö–º–∞–¥—É–ª–ª–∏–Ω–∞ 2020 - –ê—Ç—Ä–æ—Ñ–∏—è –º–æ–∑–≥–∞                                         ‚ïë
‚ïë  ‚Ä¢ –ê–ª—Å—ã–Ω–±–∞–µ–≤ 2015 - –¢–µ—Ç—Ä–∞—ç–¥—Ä–∞–ª—å–Ω–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å                           ‚ïë
‚ïë  ‚Ä¢ –ë–ª–∞–Ω–∫–æ 2013 - ANIRLE –∫–æ–º–ø—Ä–µ—Å—Å–∏—è                                          ‚ïë
‚ïë  ‚Ä¢ –õ–∞–≤—Ä–µ–Ω–∫–æ–≤ 2016 - –ö–æ—ç–≤–æ–ª—é—Ü–∏—è —ç–º–æ—Ü–∏–π                                       ‚ïë
‚ïë  ‚Ä¢ + LightPattern 1KB                                                        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    python main.py [--voxels N] [--backend open3d|plotly|matplotlib]
    
    Drag-and-drop —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É drop_zone/ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ UI.
"""

import os
import sys
import time
import threading
import argparse
from pathlib import Path
from typing import Optional
import numpy as np

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from voxel_core import Voxel, ANIRLEStorage, compute_semantic_fingerprint
from organism import MetaOrganism, FileCreature, OrganismState
from visualizer import (
    create_visualizer, Open3DVisualizer, PlotlyVisualizer,
    MatplotlibVisualizer, HAS_OPEN3D, HAS_PLOTLY, HAS_MATPLOTLIB
)

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ tkinter –¥–ª—è UI
try:
    import tkinter as tk
    from tkinter import ttk, filedialog, messagebox
    from tkinter import dnd  # Drag and drop
    HAS_TKINTER = True
except ImportError:
    HAS_TKINTER = False
    print("‚ö†Ô∏è tkinter –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º")


class CrimeaAIApplication:
    """
    –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ CrimeaAI Meta Organism.
    """
    
    def __init__(self, num_voxels: int = 50000, backend: str = 'auto'):
        """
        Args:
            num_voxels: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∫—Å–µ–ª–µ–π –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50k –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
            backend: –ë—ç–∫–µ–Ω–¥ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ ('open3d', 'plotly', 'matplotlib', 'auto')
        """
        self.num_voxels = num_voxels
        self.backend = backend
        self.organism: Optional[MetaOrganism] = None
        self.visualizer = None
        self.running = False
        self.paused = False
        
        # –ü—É—Ç—å –¥–ª—è drag-and-drop —Ñ–∞–π–ª–æ–≤
        self.drop_zone = Path(__file__).parent / "drop_zone"
        self.drop_zone.mkdir(exist_ok=True)
        self.processed_files = set()
        
        # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        self.root: Optional[tk.Tk] = None
        self.status_labels = {}
        
        # –ü–æ—Ç–æ–∫–∏
        self.update_thread: Optional[threading.Thread] = None
        self.file_watch_thread: Optional[threading.Thread] = None
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.fps = 0
        self.frame_times = []
        
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     CrimeaAI META ORGANISM v1.0                              ‚ïë
‚ïë                   üß¨ –ñ–∏–≤–æ–µ –¶–∏—Ñ—Ä–æ–≤–æ–µ –°–æ–∑–Ω–∞–Ω–∏–µ üß¨                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        """)
    
    def initialize(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"""
        print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CrimeaAI Meta Organism...")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
        print(f"üß¨ –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ ({self.num_voxels} –≤–æ–∫—Å–µ–ª–µ–π)...")
        self.organism = MetaOrganism(num_voxels=self.num_voxels)
        
        # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        self.organism.on_integration = self._on_integration
        self.organism.on_trauma = self._on_trauma
        self.organism.on_update = self._on_update
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        print(f"üé® –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ ({self.backend})...")
        try:
            self.visualizer = create_visualizer(self.backend)
            if hasattr(self.visualizer, 'initialize'):
                self.visualizer.initialize()
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞: {e}")
            self.visualizer = None
        
        print("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        print(f"üìÅ Drop zone: {self.drop_zone.absolute()}")
        print("   –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ —ç—Ç—É –ø–∞–ø–∫—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º\n")
    
    def _on_integration(self, creature: FileCreature):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"""
        print(f"üíö –ö–ê–ô–§! {creature.file_path} –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º")
        if self.root:
            self._flash_ui('green')
    
    def _on_trauma(self, creature: FileCreature, voxels_lost: int):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–∞–≤–º—ã"""
        print(f"üî¥ –¢–†–ê–í–ú–ê! {creature.file_path} –æ—Ç—Ç–æ—Ä–≥–Ω—É—Ç–æ, –ø–æ—Ç–µ—Ä—è–Ω–æ {voxels_lost} –≤–æ–∫—Å–µ–ª–µ–π")
        if self.root:
            self._flash_ui('red')
    
    def _on_update(self, state: OrganismState):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è"""
        pass  # UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ
    
    def _flash_ui(self, color: str):
        """–ú–∏–≥–Ω—É—Ç—å UI –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Ü–≤–µ—Ç–æ–º"""
        if self.root and hasattr(self, 'main_frame'):
            original_bg = self.main_frame.cget('background')
            self.main_frame.configure(background=color)
            self.root.after(200, lambda: self.main_frame.configure(background=original_bg))
    
    def add_file(self, file_path: str):
        """–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤–æ"""
        if not os.path.exists(file_path):
            print(f"‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
            return
        
        try:
            with open(file_path, 'rb') as f:
                data = f.read()
            
            creature = self.organism.spawn_creature(file_path, data)
            print(f"üåü –°–æ–∑–¥–∞–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ –∏–∑ {os.path.basename(file_path)}")
            
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ {file_path}: {e}")
    
    def _watch_drop_zone(self):
        """–ü–æ—Ç–æ–∫ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –ø–∞–ø–∫–æ–π drop_zone"""
        while self.running:
            try:
                for file_path in self.drop_zone.iterdir():
                    if file_path.is_file() and str(file_path) not in self.processed_files:
                        self.processed_files.add(str(file_path))
                        self.add_file(str(file_path))
            except Exception as e:
                pass
            
            time.sleep(0.5)
    
    def _update_loop(self):
        """–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
        last_time = time.time()
        
        while self.running:
            if self.paused:
                time.sleep(0.1)
                continue
            
            # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ dt
            current_time = time.time()
            dt = current_time - last_time
            last_time = current_time
            
            # FPS
            self.frame_times.append(dt)
            if len(self.frame_times) > 30:
                self.frame_times.pop(0)
            self.fps = 1.0 / (sum(self.frame_times) / len(self.frame_times) + 0.001)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
            self.organism.update(dt)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            if self.visualizer and isinstance(self.visualizer, (Open3DVisualizer, MatplotlibVisualizer)):
                positions = self.organism.get_all_positions()
                colors = self.organism.get_all_colors()
                
                # –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Å–≤–µ—â–µ–Ω–∏—è
                all_voxels = list(self.organism.storage)
                for creature in self.organism.creatures:
                    if creature.alive:
                        all_voxels.extend(creature.voxels)
                
                if all_voxels:
                    emotions = np.array([v.emotion for v in all_voxels])
                    energies = np.array([v.energy for v in all_voxels])
                    traumas = np.array([v.trauma for v in all_voxels])
                else:
                    emotions = np.zeros((0, 4))
                    energies = np.zeros(0)
                    traumas = np.zeros(0)
                
                try:
                    self.visualizer.update(positions, colors, emotions, energies, traumas, dt)
                except Exception as e:
                    pass
            
            # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FPS
            elapsed = time.time() - current_time
            sleep_time = max(0, (1/60) - elapsed)
            time.sleep(sleep_time)
    
    def _create_ui(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ UI —á–µ—Ä–µ–∑ tkinter"""
        if not HAS_TKINTER:
            return
        
        self.root = tk.Tk()
        self.root.title("CrimeaAI Meta Organism - Control Panel")
        self.root.geometry("400x600")
        self.root.configure(bg='#0a0a1a')
        
        # –°—Ç–∏–ª—å
        style = ttk.Style()
        style.theme_use('clam')
        style.configure('TFrame', background='#0a0a1a')
        style.configure('TLabel', background='#0a0a1a', foreground='#00ff88', font=('Consolas', 11))
        style.configure('Title.TLabel', font=('Consolas', 14, 'bold'))
        style.configure('TButton', font=('Consolas', 10))
        
        # –ì–ª–∞–≤–Ω—ã–π —Ñ—Ä–µ–π–º
        self.main_frame = ttk.Frame(self.root, padding=20)
        self.main_frame.pack(fill=tk.BOTH, expand=True)
        
        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        title = ttk.Label(
            self.main_frame, 
            text="üß¨ CrimeaAI Meta Organism üß¨",
            style='Title.TLabel'
        )
        title.pack(pady=(0, 20))
        
        # –°—Ç–∞—Ç—É—Å –æ—Ä–≥–∞–Ω–∏–∑–º–∞
        status_frame = ttk.Frame(self.main_frame)
        status_frame.pack(fill=tk.X, pady=10)
        
        self.status_labels = {}
        status_items = [
            ('health', 'Organism Health', '100%'),
            ('voxels', 'Total Voxels', '0'),
            ('memory', 'Memory Saved', '0%'),
            ('mood', 'Current Mood', '–ø–æ–∫–æ–π'),
            ('fps', 'FPS', '0'),
            ('integrations', 'Integrations', '0'),
            ('traumas', 'Traumas', '0'),
            ('event', 'Last Event', '-'),
        ]
        
        for key, label, default in status_items:
            frame = ttk.Frame(status_frame)
            frame.pack(fill=tk.X, pady=3)
            
            lbl = ttk.Label(frame, text=f"{label}:", width=18, anchor='w')
            lbl.pack(side=tk.LEFT)
            
            val = ttk.Label(frame, text=default, width=20, anchor='e')
            val.pack(side=tk.RIGHT)
            
            self.status_labels[key] = val
        
        # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        ttk.Separator(self.main_frame, orient='horizontal').pack(fill=tk.X, pady=15)
        
        # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        btn_frame = ttk.Frame(self.main_frame)
        btn_frame.pack(fill=tk.X, pady=10)
        
        ttk.Button(
            btn_frame, 
            text="üìÅ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª",
            command=self._browse_file
        ).pack(fill=tk.X, pady=3)
        
        ttk.Button(
            btn_frame,
            text="‚è∏ –ü–∞—É–∑–∞/–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
            command=self._toggle_pause
        ).pack(fill=tk.X, pady=3)
        
        ttk.Button(
            btn_frame,
            text="üìä –ü–æ–∫–∞–∑–∞—Ç—å –≤ Plotly",
            command=self._show_plotly
        ).pack(fill=tk.X, pady=3)
        
        ttk.Button(
            btn_frame,
            text="üîÑ –°–±—Ä–æ—Å–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º",
            command=self._reset_organism
        ).pack(fill=tk.X, pady=3)
        
        # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        ttk.Separator(self.main_frame, orient='horizontal').pack(fill=tk.X, pady=15)
        
        # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        instructions = ttk.Label(
            self.main_frame,
            text=f"üìÅ Drop Zone:\n{self.drop_zone}\n\n–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ —ç—Ç—É –ø–∞–ø–∫—É\n–¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º.",
            justify=tk.CENTER,
            wraplength=350
        )
        instructions.pack(pady=10)
        
        # –¶–∏—Ç–∞—Ç—ã –∏–∑ —Ä–∞–±–æ—Ç
        quotes_frame = ttk.Frame(self.main_frame)
        quotes_frame.pack(fill=tk.BOTH, expand=True, pady=10)
        
        quotes = [
            "¬´–¢—Ä–∞–≤–º–∞ —Ç–∫–∞–Ω–µ–π –µ—Å—Ç—å –ø—É—Ç—å –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é¬ª ‚Äî –ù–∏–∫–æ–Ω–æ–≤–∞, 2013",
            "¬´–í–æ–∫—Å–µ–ª—å ‚Äî –∞—Ç–æ–º —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Å–æ–∑–Ω–∞–Ω–∏—è¬ª ‚Äî –ë–∏–º–∞–∫–æ–≤, 2013",
            "¬´–ö–æ—ç–≤–æ–ª—é—Ü–∏—è —ç–º–æ—Ü–∏–π —Å–æ–∑–¥–∞—ë—Ç —Ä–∞–∑—É–º¬ª ‚Äî –õ–∞–≤—Ä–µ–Ω–∫–æ–≤, 2016",
        ]
        
        self.quote_label = ttk.Label(
            quotes_frame,
            text=quotes[0],
            font=('Consolas', 9, 'italic'),
            foreground='#666688',
            wraplength=350,
            justify=tk.CENTER
        )
        self.quote_label.pack(pady=5)
        self.quotes = quotes
        self.quote_index = 0
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        self._update_ui()
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
        self.root.protocol("WM_DELETE_WINDOW", self._on_close)
    
    def _update_ui(self):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI"""
        if not self.root or not self.running:
            return
        
        if self.organism:
            state = self.organism.state
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫
            health_color = '#00ff88' if state.health > 0.7 else '#ffaa00' if state.health > 0.4 else '#ff4444'
            self.status_labels['health'].configure(
                text=f"{state.health*100:.1f}%",
                foreground=health_color
            )
            self.status_labels['voxels'].configure(text=f"{state.total_voxels:,}")
            self.status_labels['memory'].configure(text=f"{state.memory_saved:.1f}%")
            
            mood_colors = {'–∫–∞–π—Ñ': '#00ff88', '—Ç—Ä–µ–≤–æ–≥–∞': '#ffaa00', '–≥–Ω–µ–≤': '#ff4444', '–ø–æ–∫–æ–π': '#4488ff'}
            self.status_labels['mood'].configure(
                text=f"{state.mood} ({state.mood_intensity*100:.0f}%)",
                foreground=mood_colors.get(state.mood, '#ffffff')
            )
            
            self.status_labels['fps'].configure(text=f"{self.fps:.1f}")
            self.status_labels['integrations'].configure(text=str(state.integration_count))
            self.status_labels['traumas'].configure(text=str(state.trauma_count))
            
            # –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ (–æ–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ)
            event = state.last_event[:40] + "..." if len(state.last_event) > 40 else state.last_event
            self.status_labels['event'].configure(text=event or '-')
        
        # –°–º–µ–Ω–∞ —Ü–∏—Ç–∞—Ç—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        if hasattr(self, '_quote_counter'):
            self._quote_counter += 1
            if self._quote_counter >= 50:  # ~5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 100ms –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
                self._quote_counter = 0
                self.quote_index = (self.quote_index + 1) % len(self.quotes)
                self.quote_label.configure(text=self.quotes[self.quote_index])
        else:
            self._quote_counter = 0
        
        # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ 100ms
        self.root.after(100, self._update_ui)
    
    def _browse_file(self):
        """–î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞"""
        file_path = filedialog.askopenfilename(
            title="–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏",
            filetypes=[
                ("–í—Å–µ —Ñ–∞–π–ª—ã", "*.*"),
                ("Python", "*.py"),
                ("–¢–µ–∫—Å—Ç", "*.txt"),
                ("JSON", "*.json"),
            ]
        )
        if file_path:
            self.add_file(file_path)
    
    def _toggle_pause(self):
        """–ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ"""
        self.paused = not self.paused
        status = "‚è∏ –ü–ê–£–ó–ê" if self.paused else "‚ñ∂ –†–ê–ë–û–¢–ê–ï–¢"
        print(f"Status: {status}")
    
    def _show_plotly(self):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Plotly"""
        if not HAS_PLOTLY:
            messagebox.showwarning("Plotly", "Plotly –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            return
        
        try:
            vis = PlotlyVisualizer()
            positions = self.organism.get_all_positions()
            colors = self.organism.get_all_colors()
            
            all_voxels = list(self.organism.storage)
            for creature in self.organism.creatures:
                if creature.alive:
                    all_voxels.extend(creature.voxels)
            
            emotions = np.array([v.emotion for v in all_voxels]) if all_voxels else None
            energies = np.array([v.energy for v in all_voxels]) if all_voxels else None
            traumas = np.array([v.trauma for v in all_voxels]) if all_voxels else None
            
            state = self.organism.state
            title = f"CrimeaAI Meta Organism | Health: {state.health*100:.0f}% | Mood: {state.mood}"
            
            vis.create_figure(positions, colors, title, emotions, energies, traumas)
            vis.show()
        except Exception as e:
            messagebox.showerror("–û—à–∏–±–∫–∞", f"–û—à–∏–±–∫–∞ Plotly: {e}")
    
    def _reset_organism(self):
        """–°–±—Ä–æ—Å –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
        if messagebox.askyesno("–°–±—Ä–æ—Å", "–°–±—Ä–æ—Å–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã."):
            print("üîÑ –°–±—Ä–æ—Å –æ—Ä–≥–∞–Ω–∏–∑–º–∞...")
            self.organism = MetaOrganism(num_voxels=self.num_voxels)
            self.organism.on_integration = self._on_integration
            self.organism.on_trauma = self._on_trauma
            self.organism.on_update = self._on_update
            self.processed_files.clear()
            print("‚úÖ –û—Ä–≥–∞–Ω–∏–∑–º —Å–±—Ä–æ—à–µ–Ω")
    
    def _on_close(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞"""
        self.running = False
        if self.visualizer and hasattr(self.visualizer, 'close'):
            self.visualizer.close()
        self.root.destroy()
    
    def run(self, headless: bool = False):
        """–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        self.initialize()
        self.running = True
        
        # –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ —Ñ–∞–π–ª–∞–º–∏
        self.file_watch_thread = threading.Thread(target=self._watch_drop_zone, daemon=True)
        self.file_watch_thread.start()
        
        # –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        self.update_thread = threading.Thread(target=self._update_loop, daemon=True)
        self.update_thread.start()
        
        if headless or not HAS_TKINTER:
            # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
            print("\nüéÆ –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–±–µ–∑ UI)")
            print("–ö–æ–º–∞–Ω–¥—ã:")
            print("  add <–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É> - –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª")
            print("  status - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å")
            print("  plotly - –æ—Ç–∫—Ä—ã—Ç—å –≤ Plotly")
            print("  quit - –≤—ã—Ö–æ–¥\n")
            
            try:
                while self.running:
                    cmd = input("> ").strip().lower()
                    
                    if cmd.startswith("add "):
                        path = cmd[4:].strip()
                        self.add_file(path)
                    
                    elif cmd == "status":
                        state = self.organism.state
                        print(f"""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë Health:      {state.health*100:6.1f}%              ‚ïë
‚ïë Voxels:      {state.total_voxels:6,}               ‚ïë
‚ïë Memory:      {state.memory_saved:6.1f}%              ‚ïë
‚ïë Mood:        {state.mood:6}               ‚ïë
‚ïë Integrations:{state.integration_count:6}               ‚ïë
‚ïë Traumas:     {state.trauma_count:6}               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                        """)
                    
                    elif cmd == "plotly":
                        if HAS_PLOTLY:
                            vis = PlotlyVisualizer()
                            positions = self.organism.get_all_positions()
                            colors = self.organism.get_all_colors()
                            vis.create_figure(positions, colors)
                            vis.show()
                        else:
                            print("Plotly –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
                    
                    elif cmd in ("quit", "exit", "q"):
                        self.running = False
                        break
                    
                    elif cmd:
                        print("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞")
            
            except KeyboardInterrupt:
                print("\nüëã –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...")
                self.running = False
        
        else:
            # GUI —Ä–µ–∂–∏–º
            self._create_ui()
            self.root.mainloop()
        
        print("üß¨ CrimeaAI Meta Organism –∑–∞–≤–µ—Ä—à—ë–Ω")


def main():
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞"""
    parser = argparse.ArgumentParser(
        description="CrimeaAI Meta Organism - –ñ–∏–≤–æ–µ –¶–∏—Ñ—Ä–æ–≤–æ–µ –°–æ–∑–Ω–∞–Ω–∏–µ"
    )
    parser.add_argument(
        '--voxels', '-v',
        type=int,
        default=50000,
        help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∫—Å–µ–ª–µ–π –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50000)'
    )
    parser.add_argument(
        '--backend', '-b',
        choices=['auto', 'open3d', 'plotly', 'matplotlib'],
        default='auto',
        help='–ë—ç–∫–µ–Ω–¥ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏'
    )
    parser.add_argument(
        '--headless',
        action='store_true',
        help='–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –±–µ–∑ UI'
    )
    
    args = parser.parse_args()
    
    app = CrimeaAIApplication(
        num_voxels=args.voxels,
        backend=args.backend
    )
    app.run(headless=args.headless)


if __name__ == "__main__":
    main()



‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FILE: test_organism.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#!/usr/bin/env python3
"""
CrimeaAI Meta Organism - –¢–µ—Å—Ç—ã
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.
"""

import sys
import os
import numpy as np
import time

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from voxel_core import (
    Voxel, ANIRLEStorage, compute_semantic_fingerprint,
    cosine_similarity, TetrahedralBelonging, EmotionIndex
)
from organism import MetaOrganism, FileCreature, OrganismState


def test_voxel_creation():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ–∫—Å–µ–ª—è"""
    print("üß™ –¢–µ—Å—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–∫—Å–µ–ª—è...")
    
    voxel = Voxel(x=1.0, y=2.0, z=3.0)
    
    assert voxel.x == 1.0
    assert voxel.y == 2.0
    assert voxel.z == 3.0
    assert voxel.energy == 1.0
    assert len(voxel.emotion) == 4
    assert len(voxel.semantic) == 8
    assert len(voxel.connections) == 6
    assert voxel.is_alive()
    
    print("   ‚úÖ –í–æ–∫—Å–µ–ª—å —Å–æ–∑–¥–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_voxel_properties():
    """–¢–µ—Å—Ç —Å–≤–æ–π—Å—Ç–≤ –≤–æ–∫—Å–µ–ª—è"""
    print("üß™ –¢–µ—Å—Ç: –°–≤–æ–π—Å—Ç–≤–∞ –≤–æ–∫—Å–µ–ª—è...")
    
    voxel = Voxel(x=1.0, y=2.0, z=3.0)
    
    # –¢–µ—Å—Ç –ø–æ–∑–∏—Ü–∏–∏
    pos = voxel.pos
    assert np.allclose(pos, [1.0, 2.0, 3.0])
    
    # –¢–µ—Å—Ç –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —ç–º–æ—Ü–∏–∏
    voxel.emotion = np.array([0.8, 0.1, 0.05, 0.05])
    name, value = voxel.dominant_emotion()
    assert name == 'joy'
    assert value == 0.8
    
    # –¢–µ—Å—Ç is_alive
    voxel.energy = 0.5
    voxel.trauma = 0.3
    assert voxel.is_alive()
    
    voxel.energy = 0.0
    assert not voxel.is_alive()
    
    print("   ‚úÖ –°–≤–æ–π—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_anirle_storage():
    """–¢–µ—Å—Ç ANIRLE —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"""
    print("üß™ –¢–µ—Å—Ç: ANIRLE —Ö—Ä–∞–Ω–∏–ª–∏—â–µ...")
    
    storage = ANIRLEStorage(resolution=1.0)
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∫—Å–µ–ª–µ–π
    v1 = Voxel(x=0, y=0, z=0)
    v2 = Voxel(x=1, y=0, z=0)
    v3 = Voxel(x=0, y=1, z=0)
    
    id1 = storage.add(v1)
    id2 = storage.add(v2)
    id3 = storage.add(v3)
    
    assert len(storage) == 3
    assert id1 != id2 != id3
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ
    retrieved = storage.get(0, 0, 0)
    assert retrieved is not None
    assert retrieved.id == id1
    
    # –°–æ—Å–µ–¥–∏
    neighbors = storage.get_neighbors(v1)
    assert len(neighbors) == 2  # v2 –∏ v3
    
    # –£–¥–∞–ª–µ–Ω–∏–µ
    removed = storage.remove(1, 0, 0)
    assert removed
    assert len(storage) == 2
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    stats = storage.get_statistics()
    assert stats['total_voxels'] == 2
    
    print("   ‚úÖ ANIRLE —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_semantic_fingerprint():
    """–¢–µ—Å—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞"""
    print("üß™ –¢–µ—Å—Ç: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫...")
    
    data1 = b"Hello, World!"
    data2 = b"Hello, World!"  # –¢–æ—Ç –∂–µ
    data3 = b"Goodbye, World!"  # –î—Ä—É–≥–æ–π
    
    fp1 = compute_semantic_fingerprint(data1)
    fp2 = compute_semantic_fingerprint(data2)
    fp3 = compute_semantic_fingerprint(data3)
    
    assert len(fp1) == 8
    assert np.allclose(fp1, fp2)  # –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ = –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫
    assert not np.allclose(fp1, fp3)  # –†–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ = —Ä–∞–∑–Ω—ã–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫
    
    print("   ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_cosine_similarity():
    """–¢–µ—Å—Ç –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞"""
    print("üß™ –¢–µ—Å—Ç: –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ...")
    
    a = np.array([1, 0, 0])
    b = np.array([1, 0, 0])
    c = np.array([0, 1, 0])
    d = np.array([-1, 0, 0])
    
    assert cosine_similarity(a, b) == 1.0  # –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ
    assert cosine_similarity(a, c) == 0.0  # –û—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω—ã–µ
    assert cosine_similarity(a, d) == -1.0  # –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ
    
    print("   ‚úÖ –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_organism_creation():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
    print("üß™ –¢–µ—Å—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ (5000 –≤–æ–∫—Å–µ–ª–µ–π)...")
    
    start = time.time()
    organism = MetaOrganism(num_voxels=5000)
    elapsed = time.time() - start
    
    assert len(organism.storage) > 0
    assert organism.state.health > 0
    assert organism.radius > 0
    
    print(f"   ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω –∑–∞ {elapsed:.2f}—Å ({len(organism.storage)} –≤–æ–∫—Å–µ–ª–µ–π)")


def test_creature_creation():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤–∞ –∏–∑ —Ñ–∞–π–ª–∞"""
    print("üß™ –¢–µ—Å—Ç: –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–∞...")
    
    organism = MetaOrganism(num_voxels=1000)
    
    data = b"Test file content for creature creation"
    creature = organism.spawn_creature("test.txt", data)
    
    assert creature is not None
    assert len(creature.voxels) > 0
    assert creature.alive
    assert not creature.integrated
    
    print(f"   ‚úÖ –°—É—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–æ ({len(creature.voxels)} –≤–æ–∫—Å–µ–ª–µ–π)")


def test_compatibility_check():
    """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
    print("üß™ –¢–µ—Å—Ç: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏...")
    
    organism = MetaOrganism(num_voxels=1000)
    
    # –°–æ–∑–¥–∞—ë–º "—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π" —Ñ–∞–π–ª (–ø–æ—Ö–æ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ–º–∞–Ω—Ç–∏–∫—É –æ—Ä–≥–∞–Ω–∏–∑–º–∞)
    compatible_data = (organism.base_semantic * 255).astype(np.uint8).tobytes() * 100
    creature1 = organism.spawn_creature("compatible.py", compatible_data)
    
    # –°–æ–∑–¥–∞—ë–º "–Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π" —Ñ–∞–π–ª
    incompatible_data = ((1 - organism.base_semantic) * 255).astype(np.uint8).tobytes() * 100
    creature2 = organism.spawn_creature("incompatible.exe", incompatible_data)
    
    sem1, emo1 = organism.check_compatibility(creature1)
    sem2, emo2 = organism.check_compatibility(creature2)
    
    print(f"   –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π: sem={sem1:.2f}, emo={emo1:.2f}")
    print(f"   –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π: sem={sem2:.2f}, emo={emo2:.2f}")
    
    # –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
    # (—ç—Ç–æ –Ω–µ —Å—Ç—Ä–æ–≥–∏–π —Ç–µ—Å—Ç –∏–∑-–∑–∞ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏)
    
    print("   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç")


def test_organism_update():
    """–¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞"""
    print("üß™ –¢–µ—Å—Ç: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞...")
    
    organism = MetaOrganism(num_voxels=2000)
    
    initial_state = organism.state.health
    
    # –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    for _ in range(10):
        organism.update(0.016)
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è (–ø—É–ª—å—Å–∞—Ü–∏—è)
    assert organism.storage.tick == 10
    
    print("   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç")


def test_integration():
    """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤–∞"""
    print("üß™ –¢–µ—Å—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤–∞...")
    
    organism = MetaOrganism(num_voxels=2000)
    initial_count = len(organism.storage)
    
    # –°–æ–∑–¥–∞—ë–º —Å—É—â–µ—Å—Ç–≤–æ
    data = b"Test data" * 100
    creature = organism.spawn_creature("test.py", data)
    creature_voxels = len(creature.voxels)
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    organism.integrate_creature(creature)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    assert creature.integrated
    assert not creature.alive
    # –í–æ–∫—Å–µ–ª–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ storage, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏ –∏–∑-–∑–∞ –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–æ–∫—Å–µ–ª–µ–π —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ
    assert len(organism.storage) > initial_count
    assert organism.state.integration_count == 1
    
    added = len(organism.storage) - initial_count
    print(f"   ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (+{added} –≤–æ–∫—Å–µ–ª–µ–π –∏–∑ {creature_voxels})")


def test_rejection():
    """–¢–µ—Å—Ç –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤–∞"""
    print("üß™ –¢–µ—Å—Ç: –û—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–∞...")
    
    organism = MetaOrganism(num_voxels=5000)
    initial_count = len(organism.storage)
    
    # –°–æ–∑–¥–∞—ë–º —Å—É—â–µ—Å—Ç–≤–æ
    data = b"Malicious data" * 100
    creature = organism.spawn_creature("malware.exe", data)
    
    # –î–≤–∏–≥–∞–µ–º –∫ —Ü–µ–Ω—Ç—Ä—É
    creature.current_pos = organism.center.copy()
    for v in creature.voxels:
        v.x += organism.center[0] - creature.spawn_pos[0]
        v.y += organism.center[1] - creature.spawn_pos[1]
        v.z += organism.center[2] - creature.spawn_pos[2]
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ
    organism.reject_creature(creature, severity=0.5)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    assert creature.rejected
    assert not creature.alive
    assert len(organism.storage) < initial_count  # –ê—Ç—Ä–æ—Ñ–∏—è
    assert organism.state.trauma_count == 1
    
    voxels_lost = initial_count - len(organism.storage)
    print(f"   ‚úÖ –û—Ç—Ç–æ—Ä–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (-{voxels_lost} –≤–æ–∫—Å–µ–ª–µ–π)")


def test_positions_and_colors():
    """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –∏ —Ü–≤–µ—Ç–æ–≤"""
    print("üß™ –¢–µ—Å—Ç: –ü–æ–∑–∏—Ü–∏–∏ –∏ —Ü–≤–µ—Ç–∞...")
    
    organism = MetaOrganism(num_voxels=1000)
    
    positions = organism.get_all_positions()
    colors = organism.get_all_colors()
    
    assert len(positions) == len(organism.storage)
    assert len(colors) == len(organism.storage)
    assert positions.shape[1] == 3  # x, y, z
    assert colors.shape[1] == 3  # r, g, b
    assert np.all(colors >= 0) and np.all(colors <= 1)
    
    print("   ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –∏ —Ü–≤–µ—Ç–∞ –ø–æ–ª—É—á–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")


def test_full_scenario():
    """–ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üß™ –¢–µ—Å—Ç: –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (5 —Å–µ–∫—É–Ω–¥)...")
    
    organism = MetaOrganism(num_voxels=3000)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
    files = [
        ("good1.py", b"Python code" * 50),
        ("bad1.exe", b"\x00\xff" * 100),
        ("good2.json", b'{"key": "value"}' * 30),
    ]
    
    for name, data in files:
        organism.spawn_creature(name, data)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é
    start = time.time()
    ticks = 0
    
    while time.time() - start < 3.0:  # 3 —Å–µ–∫—É–Ω–¥—ã
        organism.update(0.016)
        ticks += 1
    
    state = organism.state
    
    print(f"   –¢–∏–∫–æ–≤: {ticks}")
    print(f"   –í–æ–∫—Å–µ–ª–µ–π: {state.total_voxels}")
    print(f"   –ó–¥–æ—Ä–æ–≤—å–µ: {state.health*100:.1f}%")
    print(f"   –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: {state.mood}")
    print(f"   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π: {state.integration_count}")
    print(f"   –¢—Ä–∞–≤–º: {state.trauma_count}")
    
    print("   ‚úÖ –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à—ë–Ω")


def run_all_tests():
    """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"""
    print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                   CrimeaAI META ORGANISM - –¢–ï–°–¢–´                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    """)
    
    tests = [
        test_voxel_creation,
        test_voxel_properties,
        test_anirle_storage,
        test_semantic_fingerprint,
        test_cosine_similarity,
        test_organism_creation,
        test_creature_creation,
        test_compatibility_check,
        test_organism_update,
        test_integration,
        test_rejection,
        test_positions_and_colors,
        test_full_scenario,
    ]
    
    passed = 0
    failed = 0
    
    for test in tests:
        try:
            test()
            passed += 1
        except Exception as e:
            print(f"   ‚ùå –û–®–ò–ë–ö–ê: {e}")
            failed += 1
    
    print(f"""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                          –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í                                   ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: {passed:3}                                                       ‚ïë
‚ïë  ‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed:3}                                                       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    """)
    
    return failed == 0


if __name__ == "__main__":
    success = run_all_tests()
    sys.exit(0 if success else 1)


‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
END OF CODE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
